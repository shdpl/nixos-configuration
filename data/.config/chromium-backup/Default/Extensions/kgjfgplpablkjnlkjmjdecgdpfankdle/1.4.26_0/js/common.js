var COMMON={baseUrl:"https://zoom.us/",loginUrl:"mimo/login",logoutUrl:"mimo/logout",scheduleMeetingUrl:"mimo/schedule",schedulePMIMeetingUrl:"mimo/pmi",schedulePACMeetingUrl:"mimo/schedule_pac",editMeetingUrl:"mimo/editMeeting",deleteMeetingUrl:"mimo/deleteMeeting",validateTokenURL:"mimo/validtoken",saveSettingURL:"mimo/save_setting",validAlternativeHost:"mimo/valid_althost",client_id:"849883241272-q09d038e5fg93hei7c259g1s3e6mi6hn.apps.googleusercontent.com",scope:"profile email",redirect_uri:"https://zoom.us/google/oauth",state:"https://zoom.us/google/oauth/mimo_code",populateZakAndZpk:function(n){var t=COMMON.getZoomZakRequestToken();t?$.extend(n,{zak:t}):$.extend(n,{zpk:COMMON.getZoomRequestToken()})},getOAuthURL:function(){return"https://accounts.google.com/o/oauth2/auth?response_type=code&access_type=offline&client_id="+COMMON.client_id+"&scope="+COMMON.scope+"&redirect_uri="+COMMON.redirect_uri+"&state="+COMMON.state},checkPoint:function(n){var t=new Date(15244416e5),i=COMMON.getZoomRequestToken()||"",r=COMMON.getValue("zoom_token_modified_date");t-r>0&&i&&COMMON.switchZPK(n)},switchZPK:function(n){n();$.ajax({type:"POST",url:COMMON.getUserBaseUrl()+"mimo/checkto",data:{zpk:COMMON.getZoomRequestToken()},headers:{"X-Requested-With":"XMLHttpRequest","X-Requested-From":"ZOOM-EXTENSION"},dataType:"json",success:function(n){n.status&&(COMMON.saveZoomRequestToken(n.result._zm_zpk),COMMON.saveZoomDataModifiedDate(new Date))}})},schedulePACMeeting:function(n,t,i){var f=COMMON.getUserBaseUrl()+COMMON.schedulePACMeetingUrl,r=COMMON.getValue("zoom_config_pacindex")||"1",u;isNaN(parseInt(r,10))&&(r="1");u={selectedPAC:r,trackfields:n.trackfields};COMMON.populateZakAndZpk(u);$.ajax({type:"POST",url:f,data:u,timeout:1e4,headers:{"X-Requested-With":"XMLHttpRequest","X-Requested-From":"ZOOM-EXTENSION"},dataType:"json",success:function(n){n.status?(n.result&&(COMMON.saveZoomRequestToken(n.result._zm_zpk),COMMON.saveZoomZakRequestToken(n.result._zm_zak),COMMON.saveZoomDataModifiedDate(new Date)),t(n)):i(n)},error:function(n){i(n)}})},scheduleMeeting:function(n,t,i){var v=!!COMMON.getValue("zoom_config_jbh"),y=!!COMMON.getValue("zoom_config_has_password"),p=COMMON.getValue("zoom_config_pwdtype")||"1",w=!!COMMON.getValue("zoom_config_mute_upon_entry"),b=!!COMMON.getValue("zoom_config_public_cal"),k=!!COMMON.getValue("zoom_config_pmi"),d=COMMON.getValue("zoom_config_video_host")||"off",g=COMMON.getValue("zoom_config_video_participants")||"off",nt=COMMON.getValue("zoom_config_audio")||"both",h=COMMON.getValue("zoom_config_schedule_for")||"",tt=COMMON.getValue("zoom_config_domaininfo")||"",it=!!COMMON.getValue("zoom_config_signedin"),rt=COMMON.getValue("zoom_config_rectype"),l="",c="",r={},a,u,f,e,o,s;COMMON.populateZakAndZpk(r);k?c=COMMON.getUserBaseUrl()+COMMON.schedulePMIMeetingUrl:(c=COMMON.getUserBaseUrl()+COMMON.scheduleMeetingUrl,y&&(u=n.password,a=u&&""!=u?u:COMMON.getValue("zoom_config_inputpwd"),l="2"==p?a:COMMON.generatePassword()),f="Zoom Meeting",e=COMMON.getZoomData(),e&&(o=e.assistants,h&&o&&o.length>0?$.each(o,function(n,t){t.id==h&&(f=COMMON.resolveUserName(t.name)+" Zoom Meeting")}):f=COMMON.resolveUserName(e.displayName)+" Zoom Meeting"),s=COMMON.getValue("zoom_config_althost"),s&&s!=""&&$.extend(r,{mtg_alternative_host:s.replace(/,/g,";")}),$.extend(r,{ext_version:"1.4.26",topic:f,scheduleTime:n.scheduleTime,option_jbh:v,mute_upon_entry:w,public_cal:b,password:l,option_video_host:d,option_video_participants:g,option_schedule_for:h,option_enforce_signedin:it,option_domain_info:tt,option_audio_type:nt,option_record_type:rt,trackfields:n.trackfields,timezone:n.timezone}));$.ajax({type:"POST",url:c,data:r,timeout:1e4,headers:{"X-Requested-With":"XMLHttpRequest","X-Requested-From":"ZOOM-EXTENSION"},dataType:"json",success:function(n){n.status?(n.result&&(COMMON.saveZoomRequestToken(n.result._zm_zpk),COMMON.saveZoomZakRequestToken(n.result._zm_zak),COMMON.saveZoomDataModifiedDate(new Date)),t(n)):n.errorCode==201?(COMMON.clearAllData(),alert("Your Zoom Chrome Extension session has expired. Please login again.")):i(n)},error:function(n){i(n)}})},editMeeting:function(n,t,i){var n={meetingNumber:n.number,duration:n.duration,scheduleTime:n.startTime,timezone:n.timezone,isRepeat:n.isRepeat,zoomrooms:n.zoomrooms,topic:n.topic};COMMON.populateZakAndZpk(n);$.ajax({type:"POST",url:COMMON.getUserBaseUrl()+COMMON.editMeetingUrl,data:n,headers:{"X-Requested-With":"XMLHttpRequest","X-Requested-From":"ZOOM-EXTENSION"},dataType:"json",success:function(n){n.status?t(n):n.errorCode==201?COMMON.clearAllData():i(n)}})},deleteMeeting:function(n,t,i){var n={number:n.number};COMMON.populateZakAndZpk(n);$.ajax({type:"POST",url:COMMON.getUserBaseUrl()+COMMON.deleteMeetingUrl,data:n,headers:{"X-Requested-With":"XMLHttpRequest","X-Requested-From":"ZOOM-EXTENSION"},dataType:"json",success:function(n){n.status?t(n):i(n)}})},getZoomSetting:function(){var n={};return n.zoom_config_schedule_for=COMMON.getValue("zoom_config_schedule_for"),n.zoom_assistants=COMMON.getZoomData().assistants,n.zoom_config_video_host=COMMON.getValue("zoom_config_video_host")||"off",n.zoom_config_video_participants=COMMON.getValue("zoom_config_video_participants")||"off",n.zoom_config_audio=COMMON.getValue("zoom_config_audio")||"both",n.zoom_config_hasOther=!!COMMON.getZoomData().option_has3rd,n.zoom_config_noBoth=!!COMMON.getZoomData().option_noboth,n.zoom_config_jbh=!!COMMON.getValue("zoom_config_jbh"),n.zoom_config_watermark=!!COMMON.getValue("zoom_config_watermark"),n.zoom_config_has_password=!!COMMON.getValue("zoom_config_has_password"),n.zoom_config_pwdtype=COMMON.getValue("zoom_config_pwdtype")||"1",n.zoom_config_mute_upon_entry=!!COMMON.getValue("zoom_config_mute_upon_entry"),n.zoom_config_hasPubCal=!!COMMON.getZoomData().option_haspublic_cal,n.zoom_config_public_cal=!!COMMON.getValue("zoom_config_public_cal"),n.zoom_config_pmi=!!COMMON.getValue("zoom_config_pmi"),n.zoom_config_pmiNum=COMMON.getZoomData().PMI,n.enforcelogin=COMMON.getZoomData().forcelogin,n.zoom_config_signedin=!!COMMON.getValue("zoom_config_signedin"),n.zoom_config_domaininfo=COMMON.getValue("zoom_config_domaininfo")||"",n.zoom_support_althost=!(COMMON.getZoomData().alt_hosts===undefined),n.zoom_config_althost=COMMON.getValue("zoom_config_althost"),n.zoom_config_fixed_popup=!!COMMON.getValue("zoom_config_fixed_popup"),n.zoom_config_enable_watermark=!!COMMON.getZoomData().option_enable_watermark,n.zoom_trackfields=COMMON.getZoomData().trackfields,n.zoom_record_type=COMMON.getValue("zoom_config_rectype"),n.zoom_local_record=COMMON.getZoomData().recording.option_local_recording,n.zoom_cloud_record=COMMON.getZoomData().recording.option_cloud_recording,n.lockOpts=COMMON.getZoomData().lockedoptions,n},updateZoomSetting:function(n,t){COMMON.saveValue("zoom_config_schedule_for",n.zoom_config_schedule_for);COMMON.saveValue("zoom_config_video_host",n.zoom_config_video_host);COMMON.saveValue("zoom_config_video_participants",n.zoom_config_video_participants);COMMON.saveValue("zoom_config_audio",n.zoom_config_audio);COMMON.saveValue("zoom_config_has_password",n.zoom_config_has_password);COMMON.saveValue("zoom_config_jbh",n.zoom_config_jbh);COMMON.saveValue("zoom_config_watermark",n.zoom_config_watermark);COMMON.saveValue("zoom_config_mute_upon_entry",n.mute_upon_entry);COMMON.saveValue("zoom_config_public_cal",n.public_cal);COMMON.saveValue("zoom_config_pmi",n.zoom_config_pmi);n.zoom_config_has_password&&"2"==COMMON.getValue("zoom_config_pwdtype")&&COMMON.saveValue("zoom_config_inputpwd",n.zoom_config_inputpwd);n.zoom_config_pwdtype=COMMON.getValue("zoom_config_pwdtype");n.zoom_config_pacindex=COMMON.getValue("zoom_config_pacindex");COMMON.saveValue("zoom_config_signedin",n.zoom_config_signedin);n.zoom_config_signedin&&COMMON.saveValue("zoom_config_domaininfo",n.zoom_config_domaininfo);COMMON.saveValue("zoom_config_althost",n.zoom_config_alternativehost);COMMON.saveValue("zoom_config_rectype",n.record_type);n.zoom_config_fixed_popup=COMMON.getValue("zoom_config_fixed_popup");COMMON.saveZoomSetting(n,t,function(){})},validAlternateHost:function(n,t){$.ajax({type:"POST",url:COMMON.getUserBaseUrl()+COMMON.validAlternativeHost,data:{alternativehost:n},async:!1,timeout:3e3,headers:{"X-Requested-With":"XMLHttpRequest","X-Requested-From":"ZOOM-EXTENSION"},dataType:"json",success:function(n){n.status?t(n):fail(n)},error:function(n){fail(n)}})},saveZoomSetting:function(n,t,i){n.zoom_config_alternativehost=(n.zoom_config_alternativehost||"").replace(/,/g,";");var r={};COMMON.populateZakAndZpk(r);$.extend(r,n);$.ajax({type:"POST",url:COMMON.getUserBaseUrl()+COMMON.saveSettingURL,timeout:1e4,data:r,headers:{"X-Requested-With":"XMLHttpRequest"},dataType:"json",success:function(n){var r=n.result;n&&n.status?(COMMON.saveZoomRequestToken(r._zm_zpk),COMMON.saveZoomZakRequestToken(r._zm_zak),COMMON.saveZoomDataModifiedDate(new Date),COMMON.saveValue("zoom_config_fte",!1),t()):n.errorCode==1113||n.errorCode==1114||n.errorCode==1115?i(n):alert("Your Zoom Chrome Extension session has expired. Please login again.")}})},login:function(n,t,i,r){$.ajax({type:"POST",url:COMMON.getUserBaseUrl()+COMMON.loginUrl,data:{snstype:1,accesstoken:n},headers:{"X-Requested-With":"XMLHttpRequest","X-Requested-From":"ZOOM-EXTENSION"},dataType:"json",success:function(n){if(n.status){var t=n.result;COMMON.saveZoomData(t);COMMON.resetZoomOptions(t);COMMON.saveSyncTime(new Date);i()}else COMMON.clearAllData(),r()}})},signin:function(n,t,i,r){$.ajax({type:"POST",timeout:15e3,url:COMMON.getUserBaseUrl()+"signin",data:n,headers:{"X-Requested-With":"XMLHttpRequest","X-Requested-From":"ZOOM-EXTENSION"},dataType:"json",success:function(n){n.status?t(n.result):i(n.errorMessage)},complete:function(){r()}})},logout:function(n){var i=COMMON.getZoomRequestToken(),r=COMMON.getZoomZakRequestToken(),t={};COMMON.populateZakAndZpk(t);r||i?$.ajax({type:"POST",timeout:1e4,url:COMMON.getUserBaseUrl()+COMMON.logoutUrl,data:t,headers:{"X-Requested-With":"XMLHttpRequest","X-Requested-From":"ZOOM-EXTENSION"},dataType:"json",success:function(){COMMON.clearAllData();n()},error:function(){COMMON.clearAllData();n()}}):(COMMON.clearAllData(),n());3==COMMON.getValue("zoom_auth_type")&&$.ajax({url:"https://accounts.google.com/Logout",type:"GET",timeout:5e3,success:function(){},error:function(){}})},resolveZoomUrl:function(n){n+=n.indexOf("?")>=0?"&":"?";var t=COMMON.getZoomZakRequestToken();return t?n+"zak="+COMMON.getZoomZakRequestToken():n+"zpk="+COMMON.getZoomRequestToken()},getMeetingWithVideoUrl:function(){return COMMON.resolveZoomUrl(COMMON.getUserBaseUrl()+"start/videomeeting")},getMeetingWithoutVideoUrl:function(){return COMMON.resolveZoomUrl(COMMON.getUserBaseUrl()+"start/webmeeting")},getMyMeetingsUrl:function(){return COMMON.resolveZoomUrl(COMMON.getUserBaseUrl()+"profile")},getUserBaseUrl:function(){var t=COMMON.baseUrl,n=COMMON.getZoomData();return n&&n._zm_baseurl&&""!=n._zm_baseurl&&(t=n._zm_baseurl+"/"),t},getGoogleCalendarUrl:function(n){function o(n){return n.toISOString().replace(/(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2})\.\d+Z/ig,"$1$2$3T$4$5$6Z")}var t,s,h,i,r,u,e,f;return Date.prototype.addHours=function(n){return this.setHours(this.getHours()+n),this},t=new Date,t.setHours(t.getHours()+1),t.setMinutes(0),s=o(t),t.setHours(t.getHours()+1),h=o(t),i="http://calendar.google.com/calendar/event?action=TEMPLATE&text=",r="Zoom Meeting",u=COMMON.getZoomData(),u&&(e=COMMON.getValue("zoom_config_schedule_for")||"",f=u.assistants,e&&f&&f.length>0?$.each(f,function(n,t){t.id==e&&(r=COMMON.resolveUserName(t.name)+" Zoom Meeting")}):r=COMMON.resolveUserName(u.displayName)+" Zoom Meeting"),i+=encodeURIComponent(r),i+="&dates=",i+=s+"/"+h,i+="&trp=true&zoomrd="+t.getTime(),n&&(i+="&zoompmi=true"),i},resolveUserName:function(n){return n=$.trim(n),n.charAt(n.length-1)==="s"?n+"'":n+"'s"},getZoomData:function(){return JSON.parse(COMMON.getValue("zoom_data"))},saveZoomData:function(n){COMMON.saveValue("zoom_data",JSON.stringify(n));COMMON.saveZoomDataModifiedDate(new Date);COMMON.saveZoomRequestToken(n._zm_zpk);COMMON.saveZoomZakRequestToken(n._zm_zak);COMMON.saveValue("zoom_zpk_exp",n._zm_zpk_exp);COMMON.saveValue("zoom_locale",n._zm_locale)},resetZoomOptions:function(n){COMMON.saveValue("zoom_config_video_host",n.option_video_host);COMMON.saveValue("zoom_config_video_participants",n.option_video_participant);COMMON.saveValue("zoom_config_audio",n.option_audio_type);COMMON.saveValue("zoom_config_has_password",n.option_require_pwd);COMMON.saveValue("zoom_config_pwdtype",n.option_pwd_type);COMMON.saveValue("zoom_config_jbh",n.option_require_jbh);COMMON.saveValue("zoom_config_watermark",n.option_watermark);COMMON.saveValue("zoom_config_mute_upon_entry",n.option_mute_upon_entry);COMMON.saveValue("zoom_config_public_cal",n.option_public_cal);COMMON.saveValue("zoom_config_pmi",n.option_use_pmi);COMMON.saveValue("zoom_config_fte",n.option_fte);COMMON.saveValue("zoom_config_schedule_for",n.option_schedulefor_host);COMMON.saveValue("zoom_config_pacindex",n.option_pacindex);COMMON.saveValue("zoom_config_signedin",n.option_enforce_login);COMMON.saveValue("zoom_config_domaininfo",n.option_domain_info);COMMON.saveValue("zoom_config_althost",n.alt_hosts||"");COMMON.saveValue("zoom_config_fixed_popup",!!n.option_fixed_popup);COMMON.saveValue("zoom_locale",n._zm_locale);COMMON.saveValue("zoom_config_rectype",n.option_record_type)},saveSyncTime:function(n){COMMON.saveValue("zoom_sync_date",n.getTime())},removeZoomData:function(){COMMON.removeValue("zoom_data")},getZoomDataModifiedDate:function(){var n=COMMON.getValue("zoom_token_modified_date");return n?new Date(parseInt(n,10)):undefined},saveZoomDataModifiedDate:function(n){COMMON.saveValue("zoom_token_modified_date",n.getTime())},removeZoomDataModifiedDate:function(){COMMON.removeValue("zoom_token_modified_date")},hasZoomRqToken:function(){var n=COMMON.getZoomZakRequestToken(),t=COMMON.getZoomRequestToken();return n||t?!0:!1},getZoomRequestToken:function(){var n=COMMON.getZoomDataModifiedDate(),t=COMMON.getExpirationTime();return!n||n&&new Date-n>t?(COMMON.clearAllData(),undefined):COMMON.getValue("zoom_zpk")},getZoomZakRequestToken:function(){var n=COMMON.getZoomDataModifiedDate(),t=COMMON.getExpirationTime();return!n||n&&new Date-n>t?(COMMON.clearAllData(),undefined):COMMON.getValue("zoom_zak")},ssoCheck:function(n,t,i,r){$.ajax({type:"POST",timeout:6e3,url:COMMON.getUserBaseUrl()+"mimo/ssocheck",data:n,headers:{"X-Requested-With":"XMLHttpRequest","X-Requested-From":"ZOOM-EXTENSION"},dataType:"json",success:function(n){n.status&&n.result&&n.result.ssoVanityUrl?t(n.result.ssoVanityUrl):i()},complete:function(){r()}})},toSync:function(n,t){var r=new Date,u=new Date,f=COMMON.getValue("zoom_sync_date"),i;u=f?new Date(parseInt(f,10)):new Date(r.getTime()-1728e5);i={ext_version:"1.4.26",snstype:1,accesstoken:COMMON.getGoogleToken()};COMMON.populateZakAndZpk(i);r-u>=864e5?(n(),$.ajax({type:"POST",timeout:5e3,url:COMMON.getUserBaseUrl()+COMMON.loginUrl,data:i,headers:{"X-Requested-With":"XMLHttpRequest","X-Requested-From":"ZOOM-EXTENSION"},dataType:"json",success:function(n){if(n.status){var t=n.result;COMMON.saveZoomData(t);COMMON.resetZoomOptions(t);COMMON.saveSyncTime(new Date)}},complete:function(){t()}})):t()},saveZoomRequestToken:function(n){COMMON.saveValue("zoom_zpk",n)},saveZoomZakRequestToken:function(n){COMMON.saveValue("zoom_zak",n||"")},getGoogleToken:function(){return COMMON.getValue("google_token")},saveGoogleToken:function(n){COMMON.saveValue("google_token",n)},getExpirationTime:function(){var n=2592e6,t=COMMON.getValue("zoom_zpk_exp");return t&&(n=parseInt(t,10)*1e3),n},removeGoogleToken:function(){COMMON.removeValue("google_token")},clearAllData:function(){COMMON.removeGoogleToken();COMMON.removeZoomData();COMMON.removeZoomDataModifiedDate();COMMON.removeValue("zoom_zpk");COMMON.removeValue("zoom_zpk_exp")},getValue:function(n){var t=localStorage.getItem(n);return t==="false"?!1:t==="true"?!0:t},saveValue:function(n,t){localStorage.setItem(n,t)},removeValue:function(n){localStorage.removeItem(n)},generatePassword:function(){for(var t=[],n=0;n<6;n++)t.push(parseInt(Math.random(0,1)*10,10));return t.join("")},getReturnChar:function(){var n=COMMON.getOS();return n==="Windows"?"\r\n":"\r"},getOS:function(){var n=navigator.appVersion;return n.indexOf("Win")>=0?"Windows":n.indexOf("Mac")>=0?"Mac":n.indexOf("X11")>=0?"Unix":n.indexOf("Linux")>=0?"Linux":"unknown"},empty:function(){}}