var MsPortalFx;(function(n){var t;(function(t){var i;(function(t){var i;(function(i){"use strict";function e(n){return typeof n=="function"}var a=n.Base,vt=n.Data,h=n.Helpers,w=n.ViewModels,b=n.Services.Gallery,o=n.ViewModels.ParameterCollection.Internal.ProvisioningTelemetry,k=n.getUniqueId,u=ko.observable,d=ko.toJS,yt=new a.Diagnostics.Log("MsPortalFx/ViewModels/ParameterCollectionV2/Internal/ParameterCollectorImpl"),v="enableProvisioning",g=b.Constants,y=g.GalleryOptionsKey,pt=g.GalleryParametersKey,wt=a.Constants.ExtensionNames.Hubs,p=new a.Diagnostics.Log("MsPortalFx/ViewModels/ParameterCollectionV2/Internal/ProvisionerImpl"),nt="masterIsProvisioningPart",c="parameterCollection",tt="preserveJourney",bt="previousOutputParameters",kt=new a.Diagnostics.Log("MsPortalFx/ViewModels/ParameterCollectionV2/Internal/ParameterProviderImpl"),it="provisionOnStartboardPart",f="",s=undefined,dt={lifetimeManagerMissing:f,inputsMissing:f,overrideInputParametersMissing:f,dataModelTypeNotRegistered:
f,provisionerMissing:f,provBindingInternalsMissing:f,provisioningEntityDisabled:f,insufficientInformation:f,provisionerBindingMissing:f,editScopeImplMissing:f,collectorCallbacksMissing:f,providerAlreadyRegistered:f,noCallbacks:f,overrideOutputParametersRejected:f,optionsMissing:f,privateFpTcBIMissing:f,privatePcPrBIMissing:f},r=FxImpl.getErrorMap(dt),gt=(function(){function n(){}return n.createEditScope=function(n,t,i,r){return new rt(n,t,i,r)},n})(),rt,ut,ft,et,ot,st,ht,ct,lt,at,l;i.EditScopeFactory=gt;rt=(function(){function i(n,t,i,u){this._editScopeCache=null;this._editScopeView=null;this._editScopeFetchPromise=null;this._haveEditScopeIdPromise=null;this._editScopeId=null;this._initializeMethod=null;this._lifetimeManager=null;this._providerRole=null;this._stubDataModel=null;t||r.lifetimeManagerMissing();this._providerRole=n;this._lifetimeManager=t;u&&(this._editScopeView=u);this._initializeMethod=i}return Object.defineProperty(i.prototype,"editScope",{get:function(){return this._getEditScopeView(
).editScope},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"dataModel",{get:function(){var r=this._getEditScopeView().editScope(),n,i;return!!this._editScopeId&&r?r.root:(n=this.collectorInputs,i=n&&n.inputParameters,i)?(this._stubDataModel||(this._stubDataModel=t.Utilities.parametersToModel(i)),this._stubDataModel):null},enumerable:!0,configurable:!0}),i.prototype.processInputs=function(n){this._editScopeId=n.editScopeId;var t=n.privateFcTpBI,i=t&&t.inputs;return i&&(this.collectorInputs=JSON.parse(JSON.stringify(i))),this._haveEditScopeIdPromise&&this._editScopeId&&this._haveEditScopeIdPromise.resolve(),null},i.prototype.initializeEditScope=function(){this._getEditScopeView()},i.prototype.fetchEditScope=function(){var n=this;return this._editScopeFetchPromise||(this._editScopeFetchPromise=Q(!0).then((function(){return n._editScopeId||(n._haveEditScopeIdPromise=Q.defer()),n._haveEditScopeIdPromise})).then((function(){return n._editScopeView.fetchForExistingData(n._editScopeId,
n.collectorInputs)})).then((function(){return e(n._initializeMethod)&&n._initializeMethod()}))),this._editScopeFetchPromise},i.prototype.initializeDataModel=function(n,t){var e=this,i,u,f;return n||r.inputsMissing(),t||r.overrideInputParametersMissing(),i=h.Deferred(),u=function(t){var r=e._createEditScopeModelFromInputs(t,n.inputMetadata);i.resolve(r)},t?(f=t(n.inputParameters,n.inputMetadata,n.options),f?f.then((function(n){e.collectorInputs=n;u(n.inputParameters)}),(function(){i.reject()})):u(n.inputParameters)):u(n.inputParameters),i.promise()},i.prototype.discardEditScopeEdits=function(){var n=this._editScopeCache;n&&n.disposeAndDiscardEdits(this._editScopeId,this._editScopeView)},i.prototype._getEditScopeCache=function(){var i=this,n,t;return this._editScopeCache||(n=this._providerRole,t=n&&n.dataModelTypeName,!t||vt.Metadata.getTypeMetadata(t)||r.dataModelTypeNotRegistered(t),this._editScopeCache=new FxImpl.Data.EditScopeCacheOld({entityTypeName:t,supplyExistingData:function(t){return i.
initializeDataModel(t,(function(){return n&&e(n.overrideInputParameters)?n.overrideInputParameters(t.inputParameters,t.inputMetadata,t.options):h.resolve(t)}))},serializeParams:function(){return"#"}}),this._lifetimeManager.registerForDispose(this._editScopeCache)),this._editScopeCache},i.prototype._getEditScopeView=function(){return this._editScopeView||(this._editScopeView=this._getEditScopeCache().createView(this._lifetimeManager)),this._editScopeView},i.prototype._createEditScopeModelFromInputs=function(n,t){var f={},i,r,e;for(i in n){f[i]={};for(r in n[i])e=n&&n[i]&&n[i][r]||t&&t[i]&&t[i][r]&&t[i][r].defaultValue||"",f[i][r]=u(e)}return f},__decorate([n.Composition.ProxyCompatibilityMode],i)})();ut=(function(){function n(){this.inputs=u();this.errors=u([])}return n})();i.CollectorBindingInternals=ut;ft=(function(){function n(){this.outputs=u();this.commit=u()}return n})();i.ProviderBindingInternals=ft;et=(function(){function n(){this.triggerProvisioningCommand=u();this.provisioningPartExtensionName=
u();this.provisioningPartName=u();this.triggerProvisioningInStartboardPart=u();this.masterIsProvisioningPart=u(!1);this.forceDiscardJourney=u(!0);this.provisioningCommand=u();this.provisioningAttempted=u();this.provisioningStarted=u();this.provisioningCompleted=u()}return n})();i.ProvisionerBindingInternals=et;ot=(function(){function n(){}return n.createParameterCollector=function(n,t,i,r,u){return new st(n,t,i,r,u)},n.confirmCommitSuffix="{0}_confirmCommit",n.tryCommitSuffix="_tryCommit",n})();i.ParameterCollectorFactory=ot;st=(function(){function t(n,t,i,f,e){this._providerCallbacks={};this._collectorRole=null;this._editScopeImpl=null;this._lifetimeManager=null;this._options=null;this._privateFcTpBI=null;this._providerCommitSignal=null;this._commitSignalReceived=!1;this._providerOutputsCache=null;i||r.provisionerBindingMissing();t||r.editScopeImplMissing();f||r.lifetimeManagerMissing();this._collectorRole=n;this._privateFcTpBI=i;this._editScopeImpl=t;this._lifetimeManager=f;this._options=
e||{commitWhenSignaled:!1,commitAction:null};this._providerCommitSignal=u();this._providerOutputsCache={}}return t.prototype.processInputs=function(t){var i,r;return t.privateFpTcBI&&(i=t.privateFpTcBI.commit),t.fromProviderBindingInternals&&(i=t.fromProviderBindingInternals.commit),!i||i===this._providerCommitSignal()||(r=w.ParameterCollectionV2.Internal.ParameterCollectorFactory.confirmCommitSuffix,i===r.format(this._providerCommitSignal())?this._deferredProviderDismiss&&(this._deferredProviderDismiss.resolve(),this._deferredProviderDismiss=s,this._commitSignalReceived=!1):(this.providerOutputs=t.privateFpTcBI&&t.privateFpTcBI.outputs||t.fromProviderBindingInternals&&t.fromProviderBindingInternals.outputs,this._commitSignalReceived=!0,this._providerCommitSignal(i),this._options.commitWhenSignaled&&this.commitProviderOutputs(null).then(this._options.commitAction))),n.Helpers.resolve()},t.prototype.addProvider=function(n,t){t||r.collectorCallbacksMissing();this._providerCallbacks[n]&&r.
providerAlreadyRegistered(n);this._providerCallbacks[n]=t},t.prototype.removeProvider=function(n){this._providerCallbacks[n]&&delete this._providerCallbacks[n]},t.prototype.sendInputsToProvider=function(n){var t;this._providerCallbacks[n]&&e(this._providerCallbacks[n].createInputParameters)?t=this._providerCallbacks[n].createInputParameters():this._collectorRole?t=this._collectorRole.createInputParameters(n):r.noCallbacks(n);n in this._providerOutputsCache&&(c in t.options||(t.options[c]={}),t.options[c][bt]=this._providerOutputsCache[n]);this._privateFcTpBI.inputs(t)},t.prototype.commitProviderOutputs=function(n){var t=this,i=Q.defer(),r,f=w.ParameterCollectionV2.Internal.ParameterCollectorFactory.tryCommitSuffix,u=function(){t._commitSignalReceived=!1;t._providerOutputsCache[n]=t.providerOutputs;t._validateProviderOutputs(n).then((function(){t._saveProviderOutputs(n).then((function(){t._providerCommitSignal().indexOf(f)>-1?(t._deferredProviderDismiss=i,t._privateFcTpBI.errors([{errorMessage:
null,parameterName:t._providerCommitSignal()}]),t._privateFcTpBI.errors([])):i.resolve()}),(function(){i.reject()}))}),(function(){i.reject()}));r&&r.dispose()};return this._commitSignalReceived?u():r=this._providerCommitSignal.subscribe(this._lifetimeManager,(function(){u()})),i.promise},t.prototype._validateProviderOutputs=function(n){var u=this,t=Q.defer(),i,f=this._providerCallbacks[n],o=f&&f.validateOutputParameters,s=this.providerOutputs.outputParameters,r=this._collectorRole;return e(o)?i=o(s):r&&e(r.validateOutputParameters)&&(i=r.validateOutputParameters(n,s)),i?i.then((function(n){n&&n.length>0?(u._privateFcTpBI.errors(n),u._privateFcTpBI.errors([]),t.reject()):t.resolve()}),(function(){yt.error("A rejected promise was returned by the 'validateOutputParameters' method.Resolve with the validation errors instead.");t.reject()})):t.resolve(),t.promise},t.prototype._saveProviderOutputs=function(n){var t,i=this._providerCallbacks[n],u=i&&i.saveOutputParameters,f=this.providerOutputs.outputParameters;
return(e(u)?t=u(f):this._collectorRole?t=this._collectorRole.saveOutputParameters(n,f):r.noCallbacks(n),t)?t:Q(s)},t})();ht=(function(){function n(){}return n.createParameterProvider=function(n,t){return new ct(n,t)},n})();i.ParameterProviderFactory=ht;ct=(function(){function i(n,t){this._editScopeImpl=null;this._providerRole=null;this._lastCommitSignal="";t||r.lifetimeManagerMissing();this._providerRole=n;this._editScopeImpl=t}return i.prototype.processInputs=function(n){var u=null,t,i,f,r;return n.privateFcTpBI&&(t=n.privateFcTpBI.errors,t&&t.length>0&&(i=this._lastCommitSignal,f=t.first((function(n){return n.parameterName===i})),t.length===1&&f&&(r=this._lastDiscardEdits,r&&(r(),this._lastDiscardEdits=s),this._privateFpTcBI.commit(i+"_confirmCommit"))),u=this._editScopeImpl.fetchEditScope()),u},i.prototype.getOutputsToCommit=function(){var o=t.Utilities.modelToParameters(this._editScopeImpl.dataModel),u=this._providerRole,i=u&&u.overrideOutputParameters,f;return e(i)?(i=i&&i.bind(u),f=Q.defer(
),i(o).then((function(n){f.resolve({outputParameters:n})}),(function(){r.overrideOutputParametersRejected()})),f.promise):n.Helpers.resolve({outputParameters:o})},i.prototype.commitOutputs=function(n){var i=this,f,e,h;n||r.optionsMissing();n.privateFpTcBI||r.privateFpTcBIMissing();var t=n.provisioner,u=t&&t.provisionOnStartboardPart,o=t&&t.enableProvisioning();o&&u&&!u()&&!n.privatePcPrBI&&r.privatePcPrBIMissing();f=function(){var r=n.privateFpTcBI;i._lastCommitSignal=k()+"_tryCommit";i._lastDiscardEdits=n.discardEdits;i._privateFpTcBI=r;r.commit(s);r.outputs(t&&t.mappedOutputs||n.provisionerData);r.commit(i._lastCommitSignal);o&&u&&!u()&&n.privatePcPrBI.provisioningAttempted({commitId:k()})};o?(e=t.executeProvisioning(n.provisionerData,this._editScopeImpl.collectorInputs.options),h=n.progressAction,h&&h(e),e?e.then((function(){f()}),(function(){kt.error("Provisioning action failed.")})):f()):f()},i})();lt=(function(){function n(){}return n.createProvisioner=function(n,t){return new at(n,t)},n})(
);i.ProvisionerFactory=lt;at=(function(){function t(n,t){this.enableProvisioning=u(!1);this.provisionOnStartboardPart=u(!0);this._data=null;this._executionDeferred=null;this._options=null;this._privatePcPrBI=null;this._provisionerRole=null;this._provisioningCommandSubscription=null;n||r.provisionerMissing();t||r.provBindingInternalsMissing();this._provisionerRole=n;this._privatePcPrBI=t;this._executionDeferred=h.Deferred()}return t.prototype.processInputs=function(n){var r,i,t;return this.provisionOnStartboardPart(n.provisionOnStartboardPart),this._privatePcPrBI.masterIsProvisioningPart(n.masterIsProvisioningPart),r=n.privateFcTpBI,i=r&&r.inputs,i&&(c in i.options&&i.options[c]&&(t=i.options[c],v in t&&t[v]&&this.enableProvisioning(!0),it in t?this.provisionOnStartboardPart(t[it]):this.provisionOnStartboardPart(n.provisionOnStartboardPart),nt in t?this._privatePcPrBI.masterIsProvisioningPart(t[nt]):this._privatePcPrBI.masterIsProvisioningPart(n.masterIsProvisioningPart),tt in t&&this._privatePcPrBI.
forceDiscardJourney(!t[tt])),v in i.options&&i.options[v]&&this.enableProvisioning(!0)),null},t.prototype.executeProvisioning=function(n,t){var i=this,f,nt,a,u;this.enableProvisioning()||r.provisioningEntityDisabled();var o=this._provisionerRole,v=n,w=e(o.executeCustomProvisioning),k=e(o.mapOutputsForProvisioning);if(w&&k)return p.error("You can only override 'executeCustomProvisioning' or 'mapOutputsForProvisioning', but not both."),h.reject();if(w)return this._traceProvisioningStarted(),f=o.executeCustomProvisioning(n.outputParameters,t),f?f.then((function(){i._traceProvisioningEnded(!0)}),(function(){i._traceProvisioningEnded(!1)})):this._traceProvisioningEnded(s),f;var g=t&&t[y],c=g&&g.galleryItem,l=c&&c.categoryIds;return l&&l.length>0&&(nt=l.some((function(n){return n.toLowerCase()===b.noSubCreateCategoryId})),nt)?(p.error("No custom provisioning is implemented. The gallery item '"+c.itemDisplayName+"' requires no subscriptions, which requires custom provisioning. You need to override 'executeCustomProvisioning'"),
h.reject()):k?(a=this._provisionerRole.mapOutputsForProvisioning(v.outputParameters,t),u=h.Deferred(),a?a.then((function(r){if(n.outputParameters=r,i.provisionOnStartboardPart()){if(!i._privatePcPrBI.masterIsProvisioningPart()){i._initializeProvisioningEntity(t[y]);var f={provisioningOptions:{originalData:v,data:d(n),options:d(t)}};i._privatePcPrBI.triggerProvisioningInStartboardPart(f)}u.resolve()}else i._beginExecution(n,t).then((function(){u.resolve()}),(function(){u.reject()}))}),(function(){p.error("The promise returned by 'mapOutputsForProvisioning' should not be rejected.");u.reject()})):(p.error("'mapOutputsForProvisioning' did not return a promise."),u.reject()),u.promise()):this._beginExecution(n,t)},t.prototype._initializeProvisioningEntity=function(n){var t=n.uiDefinition.markup.reference,i=t.provisioningPartName,u=t.provisioningPartExtension;i||u?t.provisioningPartName&&t.provisioningPartExtension||r.insufficientInformation():(i="ProvisionerPart",u=wt);this._privatePcPrBI.provisioningPartName(
i);this._privatePcPrBI.provisioningPartExtensionName(u)},t.prototype._beginExecution=function(t,i){var r=this;return this._data=t,this._options=i,this._provisioningCommandSubscription=this._privatePcPrBI.provisioningCommand.subscribe((function(n){n.status(l.Idle);r._executeProvisioning(n);r._provisioningCommandSubscription&&!r._provisioningCommandSubscription.isDisposed&&r._provisioningCommandSubscription.dispose()})),this._privatePcPrBI.triggerProvisioningCommand(n.getUniqueId()),this._executionDeferred.promise()},t.prototype._executeProvisioning=function(n){var t=this,i;n.status(l.InProgress);this._traceProvisioningStarted();i=n.execute({options:this._options,data:this._data});i?i.then((function(i){t.deploymentResponse=i;t._privatePcPrBI.provisioningStarted({galleryParameters:t._data.outputParameters[pt],configurationOptions:t._options[y],deploymentResponse:i});n.status(l.Succeeded);t._traceProvisioningEnded(!0);t._executionDeferred.resolve()}),(function(){n.status(l.Failed);t._traceProvisioningEnded(
!1);t._executionDeferred.reject()})):(this._traceProvisioningEnded(s),this._executionDeferred.resolve())},t.prototype._createEventBase=function(){var i=this._options&&this._options[y],n=i&&i.launchingContext,t={name:s,data:{oldCreateApi:!0}};return n&&(t.name=n.galleryItemId,t.data.launchingContext=n),t},t.prototype._traceProvisioningStarted=function(){return o.traceProvisioningStarted(this._createEventBase())},t.prototype._traceProvisioningEnded=function(n){var r=this._createEventBase(),t,i;return n===s?(t=o.ActionModifier.Succeeded,i=o.ProvisioningStatus.NoPromise):n?(t=o.ActionModifier.Succeeded,i=o.ProvisioningStatus.Resolved):(t=o.ActionModifier.Failed,i=o.ProvisioningStatus.UnknownFailure),r.actionModifier=t,r.data.provisioningStatus=i,o.traceProvisioningEnded(r)},t})(),(function(n){n[n.Idle=0]="Idle";n[n.InProgress=1]="InProgress";n[n.Succeeded=2]="Succeeded";n[n.Failed=3]="Failed"})(i.ProvisioningCommandStatus||(i.ProvisioningCommandStatus={}));l=i.ProvisioningCommandStatus})(i=t.Internal||
(t.Internal={}))})(i=t.ParameterCollectionV2||(t.ParameterCollectionV2={}))})(t=n.ViewModels||(n.ViewModels={}))})(MsPortalFx||(MsPortalFx={})),(function(n){var t;(function(t){var i;(function(t){var i;(function(t){"use strict";var o=n.Base,f=n.Helpers,u=undefined,s=ko.observable,e=n.getUniqueId,h=new o.Diagnostics.Log("MsPortalFx/ViewModels/ParameterCollection/ParameterProvider"),i="",c={collectorInputsMissing:i,editScopeIdMissing:i,editScopeViewMissing:i,inputsMissing:i,onInputsReceivedMissing:i,optionsMissing:i,overrideInputParametersMissing:i,privateFpTcBIMissing:i,privatePcPrBIMissing:i,provisionerMissing:i},r=FxImpl.getErrorMap(c),l=(function(){function t(n){this._editScopeView=u;this._editScopeFetchPromise=u;this._onInputsReceivedPromise=u;n||r.editScopeViewMissing();this._editScopeView=n}return t.prototype.fetchEditScope=function(n,t){var i=this;return this._editScopeFetchPromise||(this._editScopeFetchPromise=this._editScopeView.fetchForExistingData(n,t).finally((function(){i._editScopeFetchPromise=
u}))),this._editScopeFetchPromise},t.prototype.initializeDataModel=function(n,t){n||r.inputsMissing();t||r.overrideInputParametersMissing();var i=f.Deferred();return t(n.inputParameters).then((function(t){var f={},r,u,e;for(r in t){f[r]={};for(u in t[r])e=t&&t[r]&&t[r][u]||n.inputMetadata&&n.inputMetadata[r]&&n.inputMetadata[r][u]&&n.inputMetadata[r][u].defaultValue||"",f[r][u]=s(e)}i.resolve(f)}),(function(){i.reject()})),i.promise()},t.prototype.onCollectorBindingsReceived=function(t,i,e){var s=this;t||r.collectorInputsMissing();i||r.editScopeIdMissing();e||r.onInputsReceivedMissing();var h="enableProvisioning",o=f.Deferred(),c={enableProvisioning:!1,promise:o.promise()},l=t.options;return h in l&&l[h]&&(c.enableProvisioning=!0),this.fetchEditScope(i,t).then((function(){try{n.deepEquals(s._previousCollectorInputs,t)||(s._previousCollectorInputs=t,s._onInputsReceivedPromise=e(t));var i=s._onInputsReceivedPromise;i?i.then((function(){o.resolve()}),(function(){o.reject()})).finally((function(){s._onInputsReceivedPromise=
u})):o.resolve()}catch(r){o.reject()}}),(function(){o.reject()})),c},t.prototype.commitProvider=function(n){var t,i,u,f,o;n||r.optionsMissing();n.privateFpTcBI||r.privateFpTcBIMissing();t=n.provisioner;n.enableProvisioning&&!t&&r.provisionerMissing();i=n.enableProvisioning;!i||n.provisionOnStartboardPart||n.privatePcPrBI||r.privatePcPrBIMissing();u=function(){var u=n.privateFpTcBI,r;u.outputs(t&&t.mappedOutputs||n.provisionerData);n.privateFpTcBI.commit(e());i&&!n.provisionOnStartboardPart&&n.privatePcPrBI.provisioningAttempted({commitId:e()});r=n.discardEdits;r&&r()};i?(f=t.executeProvisioning(n.provisionerData,n.provisionerOptions),o=n.progressAction,o&&o(f),f?f.then((function(){u()}),(function(){h.error("Provisioning action has failed.")})):u()):u()},t})();t.ProviderBase=l})(i=t.Internal||(t.Internal={}))})(i=t.ParameterCollection||(t.ParameterCollection={}))})(t=n.ViewModels||(n.ViewModels={}))})(MsPortalFx||(MsPortalFx={})),(function(n){var t;(function(t){var i;(function(i){"use strict";function o(
n,t,i){var r=n&&n.stepStatuses,u=r&&r.length?r[0].status:0;return{stepId:"NoWizardStep",status:u,isFirstStep:!0,isLastStep:!0,isOptional:!1,disabled:!1,allowToggleProvisioningLocation:t,masterIsProvisioningPart:i}}var s=n.ViewModels,u=i.Internal,r=ko.observable,f=" is not implemented",e=(function(n){function t(t,i){var c=this;n.call(this,t);this.parameterCollectionErrors=r();this.privateFcTpBI=new u.CollectorBindingInternals;this.savedState=r();this.currentState=r();this.stepInput=r();this.cloudName=r();this._collectorBase=null;this._container=null;var e=this.currentState,f={stepStatuses:[]},s=i&&i.content,h=s&&s.savedState;h&&(f=h);e(f);t.selectable.isSelected.subscribe(t,(function(){c.savedState(e())}));this.stepInput(o(f,!1,!0));this._container=t;this._collectorBase=new u.CollectorBase(new u.Provisioner(this));this.privatePcPrBI=new u.ProvisioningEntityBindingInternals;this.enableProvisioning=r(!0)}return __extends(t,n),t.prototype.onInputsSet=function(n){var i=this,t;this.cloudName(u.
getCloudNameFromInputs(n));t=this.getProviderInputs(null);this.privateFcTpBI.inputs(t);this._collectorBase.onProviderBindingInternalsReceived(n.fromProviderBindingInternals,t&&t.options,n.stepOutput,(function(n,t){return i.onProviderCommit(n,t)}),(function(){i._container.selectable.isSelected(!1)}),(function(){}))},t.prototype.getProviderInputs=function(){throw new Error("'getProviderInputs'"+f);},t.prototype.onProviderCommit=function(){throw new Error("'onProviderCommit'"+f);},t})(t.OpenBladeCommand);i.BaseCommandViewModel=e})(i=t.ParameterCollection||(t.ParameterCollection={}))})(t=n.ViewModels||(n.ViewModels={}))})(MsPortalFx||(MsPortalFx={})),(function(n){var t;(function(t){var i;(function(t){"use strict";var r=n.ViewModels,l=r.ActionBars.Base,u=r.ParameterCollection.Internal,y=r.ParameterCollectionV2.Internal,c=n.Helpers,f=HubsExtension.Azure.Pricing.Constants,h=n.deepEquals,i=ko.observable,p=ko.observableArray,e=undefined,a=y.ParameterCollectorFactory,w=a.confirmCommitSuffix,b=a.tryCommitSuffix,
v=n.forEachKey,o="",k={multipleSelectors:o,getProviderInputs:o,onProviderCommit:o,onInputsReceived:o,onCommitError:o},s=FxImpl.getErrorMap(k),d=(function(o){function a(n,t,e){var s=this;o.call(this,n);this.editScopeId=i();this.actionInProgress=i(!1);this.eula=i("");this.secondaryLinkDisplayText=i("");this.galleryPricingInfo=i();this.cloudName=i();this._providerBase=null;this._actionBarOutput=null;this._actionInProgressLock=!1;this._baseCollectorInputs=null;this._baseFormContainer=null;this._baseFormSubscriptions=null;this._baseProviderCommit=null;this._baseProviderOutputs=null;this._deferredProviderDismiss=null;this._hotSpotItems=p();this._initialSelectedValue=null;this._previousOutput=null;this._provisionerInstance=null;this._savedProviderOutputs=null;this._selectableMap={};this._galleryItem=i(null);this._editScopeCache=null;this._editScopeView=null;this._editScopeCache=new FxImpl.Data.EditScopeCacheOld({entityTypeName:e,supplyExistingData:function(n){return s._providerBase.initializeDataModel(
n,(function(n){return s.overrideInputParameters(n)}))},serializeParams:function(){return"#"}});n.registerForDispose(this._editScopeCache);this._editScopeView=this._editScopeCache.createView(n);this._providerBase=new u.ProviderBase(this._editScopeView);this.privateFcTpBI=new u.CollectorBindingInternals;this.privateFpTcBI=new u.ProviderBindingInternals;this.privatePcPrBI=new u.ProvisioningEntityBindingInternals;this.editScope=this._editScopeView.editScope;this.enableProvisioning=i(!1);this.provisionOnStartboardPart=i(!0);this.parameterCollectionErrors=i();this.stepInput=i();this.stepOutput=i();var c=t&&t.content||{},a=c.selectable||{},v=c.secondaryLinkSelectable||{};this._initialSelectedValue=a.selectedValue;this.selectable=new r.Selectable({allowUnselect:!1,selectedValue:this._initialSelectedValue,isSelected:a.isSelected,isActivated:a.isActivated});n.registerForDispose(this.selectable);this.secondaryLinkSelectable=new r.Selectable({allowUnselect:!1,selectedValue:v.selectedValue,isSelected:
v.isSelected,isActivated:v.isActivated});n.registerForDispose(this.secondaryLinkSelectable);this.hotSpot=new r.SelectableSet(this._hotSpotItems,function(n,t){return n.selectedValue()===t},function(n){return n.selectedValue()},c.hotSpot);n.registerForDispose(this.hotSpot);this._actionBarOutput=i();this._baseProviderCommit=i();this._baseFormSubscriptions=[];this._baseFormContainer=n;this._provisionerInstance=new u.Provisioner(this);this._savedProviderOutputs={};this._baseFormSubscriptions.push(this._actionBarOutput.subscribe((function(n){var i,u,t;l.isCompleted(n)&&(i=function(){s.actionInProgress(!0);var n=s.getOutputsToCommit(),t=function(){var n=s._editScopeCache;n.disposeAndDiscardEdits(s.editScopeId(),s._editScopeView)};s._providerBase.commitProvider({enableProvisioning:s.enableProvisioning(),provisioner:s._provisionerInstance,provisionerData:n,provisionerOptions:s._baseCollectorInputs.options,progressAction:function(n){s._baseFormContainer.operations.add(n,{blockUi:!0})},discardEdits:
t,privateFpTcBI:s.privateFpTcBI,privatePcPrBI:s.privatePcPrBI,provisionOnStartboardPart:s.provisionOnStartboardPart()})},n.actionButtonClicked&&s.secondaryLinkSelectable.isSelected()?s.secondaryLinkSelectable.selectedValue().detailBlade===f.LegalTermsBlade.bladeName?(s._actionInProgressLock=!0,s.secondaryLinkSelectable.isSelected(!1),i()):s.secondaryLinkSelectable.isSelected(!1):(u=s.galleryPricingInfo(),t=s._galleryItem(),s.enableProvisioning()&&u&&t&&(t.products.length>0||t.productsWithNoPricing.length>0)?(s.secondaryLinkSelectable.selectedValue(r.getBladeSelection(f.LegalTermsBlade.bladeExtension,f.LegalTermsBlade.bladeName,{galleryPricingInfo:u,galleryItem:t})),s.actionInProgress(!0),s.secondaryLinkSelectable.isSelected(!0)):i()))})));this._baseFormSubscriptions.push(this.selectable.isSelected.subscribe((function(n){n||s._unselectFields()})));this._baseFormSubscriptions.push(this.secondaryLinkSelectable.isSelected.subscribe((function(n){n||s._actionInProgressLock||s.actionInProgress(!1)})
));this._baseFormSubscriptions.push(this.selectable.value.subscribe((function(n){s._resetSelectionStateOfSelectors(n)})));this._baseFormSubscriptions.push(this.parameterCollectionErrors.subscribe((function(n){n&&(s.privateFcTpBI.errors(n),s.privateFcTpBI.errors([]))})));this._baseFormSubscriptions.push(this.stepOutput.subscribe((function(n){var t=s._previousOutput;s._previousOutput=n;!h(t,n)&&l.isCompleted(n)&&s._onSelectorComplete(n.stepId).then((function(){s.selectable.isSelected(!1)}))})));n.registerForDispose(ko.computed((function(){s.galleryPricingInfo()&&s._galleryItem()?s.secondaryLinkDisplayText(f.PricingSummaryBlade.displayText):s.secondaryLinkDisplayText(null)})))}return __extends(a,o),Object.defineProperty(a.prototype,"dataModel",{get:function(){var n=this.editScope();return n&&n.root},enumerable:!0,configurable:!0}),a.prototype.onInputsSet=function(n){var g=this,b=null,s,i,v,c,l,o,y,p,t,a;if(this.cloudName(u.getCloudNameFromInputs(n)),this.editScopeId(n.editScopeId),this.provisionOnStartboardPart(
n.provisionOnStartboardPart),this.privatePcPrBI.masterIsProvisioningPart(n.masterIsProvisioningPart),s=n.privateFcTpBI,s){if(i=s.inputs,i){this._baseCollectorInputs=i;v=this._providerBase.onCollectorBindingsReceived(i,this.editScopeId(),(function(n){return g.onInputsReceived(n)}));this.enableProvisioning(v.enableProvisioning);b=v.promise;var k=i.options,d=k&&k.galleryOptions,nt=d&&d.galleryItem;this._galleryItem(nt||null)}if(c=s.errors,c&&c.length>0){this.onCommitError(c);this.onCommitError([])}}return l=n.privateFpTcBI,l&&(o=l.commit,!o||o===this._baseProviderCommit()||(o===w.format(this._baseProviderCommit())?(y=this._deferredProviderDismiss,y&&(y.resolve(),this._deferredProviderDismiss=e)):(this._baseProviderOutputs=l.outputs,this._baseProviderCommit(o)))),p=n.stepOutput,p&&this.stepOutput(p),t=n.output,t&&(a=t&&t.secondaryLinkClicked,!a||a!==this.secondaryLinkDisplayText()||this._previousSecondaryLinkCommitId===t.commitId||(this._previousSecondaryLinkCommitId=t.commitId,this.actionInProgress(
!1),this.secondaryLinkSelectable.selectedValue(r.getBladeSelection(f.PricingSummaryBlade.bladeExtension,f.PricingSummaryBlade.bladeName,{galleryPricingInfo:this.galleryPricingInfo(),galleryItem:this._galleryItem()})),this.secondaryLinkSelectable.isSelected(!0)),!t.status||a||h(t,this._actionBarOutput())||this._actionBarOutput(t)),b},a.prototype.registerHotSpot=function(n){var t=n.selectable||n,i;this._hotSpotItems.push(t);i=this.hotSpot.selectableItems().first((function(n){return n.data===t}));this._baseFormSubscriptions.push.apply(this._baseFormSubscriptions,ko.utils.twoWayBinding(t.isSelected,i.isActivated))},a.prototype.registerSelector=function(n,t){var r=this,i;this._selectableMap[n]&&s.multipleSelectors();i=t.selectable;this._selectableMap[n]=i;this._initialSelectedValue!==e&&h(this._initialSelectedValue,i.selectedValue())&&i.isSelected(this.selectable.isSelected());this._baseFormSubscriptions.push(i.isSelected.subscribe((function(t){t&&(r._unselectFields(i),r.selectable.selectedValue(
i.selectedValue()),r.stepInput({stepId:n,status:0,isLastStep:!1}),r.selectable.isSelected(!0),r._onSelectorLoad(n))})))},a.prototype.overrideInputParameters=function(n){return c.resolve(n)},a.prototype.getProviderInputs=function(){return s.getProviderInputs()||e},a.prototype.onProviderCommit=function(){return s.onProviderCommit()||e},a.prototype.onInputsReceived=function(){return s.onInputsReceived()||e},a.prototype.getOutputsToCommit=function(){var n=t.Models.modelToParameters(this.dataModel);return{outputParameters:n}},a.prototype.onCommitError=function(){return s.onCommitError()||e},a.prototype.dispose=function(){while(this._baseFormSubscriptions.length){var n=this._baseFormSubscriptions.splice(0,1)[0];n&&!n.isDisposed&&n.dispose()}o.prototype.dispose.call(this)},a.prototype._unselectFields=function(n){v(this._selectableMap,(function(t,i){n&&n===i||i.isSelected(!1)}))},a.prototype._resetSelectionStateOfSelectors=function(n){var t,i;(v(this._selectableMap,(function(r,u){u.isSelected()&&(
i=u);h(u.selectedValue(),n)&&(t=u)})),t!==i)&&(i&&i.isSelected(!1),t&&t.isSelected(!0))},a.prototype._onSelectorLoad=function(n){var i=this,t=c.Deferred();return this._providerBase.fetchEditScope(this.editScopeId(),this._baseCollectorInputs).then((function(){var r=i.getProviderInputs(n);i.privateFcTpBI.inputs(r);t.resolve()}),(function(){t.reject()})),t.promise()},a.prototype._onSelectorComplete=function(n){var t=this,i=c.Deferred(),r=this._baseProviderCommit.subscribe((function(){t._savedProviderOutputs[n]=t._baseProviderOutputs;t.onProviderCommit(n,t._baseProviderOutputs).then((function(n){n?t._baseProviderCommit().indexOf(b)>-1?(t._deferredProviderDismiss=i,t.privateFcTpBI.errors([{errorMessage:null,parameterName:t._baseProviderCommit()}]),t.privateFcTpBI.errors([])):i.resolve():i.reject()}));r.dispose()}));return this._baseFormSubscriptions.push(r),i.promise()},__decorate([n.Composition.ProxyCompatibilityMode],a)})(r.Forms.Form.ViewModel);t.BaseFormViewModel=d})(i=t.ParameterCollection||(t.ParameterCollection=
{}))})(t=n.ViewModels||(n.ViewModels={}))})(MsPortalFx||(MsPortalFx={})),(function(n){var t;(function(t){var i;(function(i){"use strict";var v=n.Base,c=n.ViewModels,h=c.Controls,o=h.Lists.Grid,y=c.Forms.Selector.ViewModel,p=v.Utilities,l=n.getUniqueId,s="infoBalloon",u=undefined,r=ko.observable,w=ko.observableArray,a=window,f="",b={getMatchingItemIndex:f,getColumns:f,itemMatchesSelection:f,createSelection:f,onProviderCommit:f,onInputsReceived:f,onCommitError:f},e=FxImpl.getErrorMap(b),k=(function(f){function c(n,e,s,h,c){var l=this,v,a,y;h===void 0&&(h=!1);c===void 0&&(c=null);f.call(this,n);this.editScopeId=r();this.triggerSelectAction=r("");this.multiselectEnabled=r(!1);this.valid=r(!1);this.showCreateAction=r(!1);this.eula=r("");this.filterPickerItemsParameterName="filterPickerItems";this.pickerItemsParameterName="pickerItems";this.listHeader=r();this.listSubHeader=r();this.isCreateActionResult=r(!1);this._createActionOutputs=null;this.pickerActivationBladeOpener=r(u);this.createActionBladeOpener=
r(u);this.itemSelectedByDefault=r();this.filterItems=r();this._filteredItems=[];this._editScopeCache=null;this._editScopeView=null;this._providerBase=null;this._pickerInputCollections=null;this._createActionProviderCommited=null;this._actionBarOutput=null;this._createSelectorField=null;this._selectorOriginalValue=r();this._selectorEditableValue=r();this._createSelectorBladeName=null;this._createSelectorBladeExtension=null;this._throttleUnselectSelectorFieldHandle=null;this._partContainer=null;this.filters=w();this.controlType=80;this.multiselectEnabled(h);v=this._editScopeCache=new FxImpl.Data.EditScopeCacheOld({supplyExistingData:function(n){return l._providerBase.initializeDataModel(n,(function(n){return l.overrideInputParameters(n)}))},serializeParams:function(){return"#"}});n.registerForDispose(v);this._editScopeView=v.createView(n);this._providerBase=new i.Internal.ProviderBase(this._editScopeView);this.privateFcTpBI=new i.Internal.CollectorBindingInternals;this.privateFpTcBI=new i.
Internal.ProviderBindingInternals;this.parameterCollectionErrors=r();this.stepInput=r();this._partContainer=n;this.createActionSelectorField=r();this._createActionProviderCommited=!1;this.isCreateActionResult(!1);this._actionBarOutput=r();a=o.Extensions.SelectableRow;y=this._getGridExtensionOptions();c?(a=a|o.Extensions.Pageable,p.extend(y,{pageable:{type:o.PageableType.Sequential,dataNavigator:c}}),this.itemsGridViewModel=new o.ViewModel(n,null,a,y)):this.itemsGridViewModel=new o.ViewModel(n,s,a,y);this.itemsGridViewModel.showHeader=!0;this.itemsGridViewModel.columns=this.getColumns();n.registerForDispose(this.itemsGridViewModel);this._initializeCreateActionSelector();this._actionBarOutput.subscribe(n,(function(n){if(t.ActionBars.Base.isCompleted(n)){var i=l.getOutputsToCommit(),r=function(){var n=v;n.disposeAndDiscardEdits(l.editScopeId(),l._editScopeView)};setTimeout((function(){l._providerBase.commitProvider({enableProvisioning:!1,provisioner:null,provisionerData:i,provisionerOptions:
l._pickerInputCollections.options,progressAction:function(n){l._partContainer.operations.add(n,{blockUi:!0})},discardEdits:r,privateFpTcBI:l.privateFpTcBI})}),100)}}));this.itemSelectedByDefault.subscribe(n,(function(n){if(l.multiselectEnabled()&&Array.isArray(n))n.forEach((function(n){var t=l.getMatchingItemIndex(n);l._selectGridItem(t)}));else if(n){var t=l.getMatchingItemIndex(n);l._selectGridItem(t)}}));this.filterItems.subscribe(n,(function(n){l._filterGridItems(n)}));this.itemsGridViewModel.items.subscribe(n,(function(n){var t,i;l._filterGridItems(l.filterItems());l._runFilters(n);c&&(t=l.itemSelectedByDefault()||[],t&&Array.isArray(t)?t.forEach((function(n){var t=l.getMatchingItemIndex(n);l._selectGridItem(t)})):t&&(i=l.getMatchingItemIndex(t),l._selectGridItem(i)))}));this.parameterCollectionErrors.subscribe(n,(function(n){l.privateFcTpBI.errors(n)}));this.itemsGridViewModel.selectableData.selectedItems.subscribe(n,(function(n){l._onSelectedItemsChanged(n)}));this.createActionBladeOpener.subscribe(
n,(function(n){n?(l._clearThrottleUnselectSelectorFieldHandle(),l.itemsGridViewModel.selectableData.selectedItems([]),l.createActionSelectorField().selectable.isSelected(!0)):l._closeBlade(l.itemsGridViewModel.selectableData.selectedItems())}))}return __extends(c,f),c.prototype.initializeCreateSelector=function(n,t,i,r,u){this._selectorOriginalValue(n);this._selectorEditableValue(n);this._createSelectorField.label(t);this._createSelectorBladeName=i;this._createSelectorBladeExtension=r;u&&ko.utils.arrayPushAll(this._createSelectorField.validations,u)},c.prototype.onInputsSet=function(t){var i=this,e=null,o,r,f,u;if(this.editScopeId(t.editScopeId),t&&t.privateFcTpBI&&t.privateFcTpBI.inputs&&(this._pickerInputCollections=t.privateFcTpBI.inputs,this.stepInput(t.stepInput),o=this._providerBase.onCollectorBindingsReceived(t.privateFcTpBI.inputs,this.editScopeId(),(function(n){return i.onInputsReceived(n)})),e=o.promise),t&&t.privateFcTpBI&&t.privateFcTpBI.errors&&t.privateFcTpBI.errors.length>0)
this.onCommitError(t.privateFcTpBI.errors);return r=t.privateFpTcBI,f=r&&r.commit,f&&f!==this._createActionProviderCommited&&(this.onProviderCommit(null,r.outputs).then((function(n){n&&(i.isCreateActionResult(!0),i.createActionSelectorField().selectable.isSelected(!1),i._createActionOutputs=r.outputs,i.itemsGridViewModel.selectableData.selectedItems([]),i.valid(!0),i.triggerSelectAction(l()))})),this._createActionProviderCommited=f),u=t.output,u&&u.status&&!n.deepEquals(u,this._actionBarOutput())&&this._actionBarOutput(u),e},c.prototype.overrideInputParameters=function(t){return n.Helpers.resolve(t)},c.prototype.getParameter=function(n,t,i){return t in i&&n in i[t]?i[t][n]:null},c.prototype.dispose=function(){this._clearThrottleUnselectSelectorFieldHandle();f.prototype.dispose.call(this)},Object.defineProperty(c.prototype,"dataModel",{get:function(){var n=this._editScopeView.editScope();if(n&&!n.isDisposed)return n.root},enumerable:!0,configurable:!0}),c.prototype.getMatchingItemIndex=function(
){return e.getMatchingItemIndex()||u},c.prototype.getColumns=function(){return e.getColumns()||u},c.prototype.itemMatchesSelection=function(){return e.itemMatchesSelection()||u},c.prototype.createSelection=function(){return e.createSelection()},c.prototype.getProviderInputs=function(){return this._pickerInputCollections},c.prototype.onProviderCommit=function(){return e.onProviderCommit()||u},c.prototype.onInputsReceived=function(){return e.onInputsReceived()||u},c.prototype.getOutputsToCommit=function(){var n=i.Models.modelToParameters(this.dataModel);return{outputParameters:n}},c.prototype.onCommitError=function(){e.onCommitError()},c.prototype._onSelectedItemsChanged=function(n){var t=n&&n.length>0,i;if(t){if(this.isCreateActionResult(!1),i=this._runFilters(n),i){this.valid(!1);return}this._closeBlade(n)}this.valid(t)},c.prototype._runFilters=function(n){var t=this,r,i;return!n||n.length<1?!1:(r=!1,i=this.filters&&this.filters(),i&&i.length>0&&i.forEach((function(i){i.getDisabledItems(
n).then((function(n){n.forEach((function(n){var i=t.itemsGridViewModel.items().first((function(i){return t.itemMatchesSelection(n.item,i)}));i&&(t._disableGridItem(i,n.disabledReason),t.itemsGridViewModel.selectableData.selectedItems.remove(i),r=!0,t._filteredItems.push(n))}))}))})),r)},c.prototype._closeBlade=function(n){var t=this,i;this._clearThrottleUnselectSelectorFieldHandle();this._throttleUnselectSelectorFieldHandle=a.setTimeout((function(){t.createActionSelectorField()&&t.createActionSelectorField().selectable.isSelected(!1)}),0);this.multiselectEnabled()||n.length!==1||(i=this.itemSelectedByDefault()&&this.itemMatchesSelection(this.itemsGridViewModel.items()[this.getMatchingItemIndex(this.itemSelectedByDefault())],n[0]),i||this.triggerSelectAction(l()))},c.prototype._clearThrottleUnselectSelectorFieldHandle=function(){this._throttleUnselectSelectorFieldHandle&&(a.clearTimeout(this._throttleUnselectSelectorFieldHandle),this._throttleUnselectSelectorFieldHandle=null)},c.prototype._getGridExtensionOptions=
function(){return{selectableRow:{selectionMode:this.multiselectEnabled()?2:1,itemMatchesSelection:this.itemMatchesSelection,createSelection:this.createSelection}}},c.prototype._selectGridItem=function(n){if(n!==-1){var t=this.itemsGridViewModel.getRowMetadata(this.itemsGridViewModel.items()[n]);t.selected(!0)}},c.prototype._disableGridItem=function(n,t){if(n){var i=this.itemsGridViewModel.getRowMetadata(n);i.disabled(!0);i.selected(!1);t&&n.hasOwnProperty(s)&&(n[s]?n[s].content(t):(n[s]=new h.DockedBalloon.ViewModel(this.lifetimeManager),n[s].content(t)))}},c.prototype._initializeCreateActionSelector=function(){var n=this;this._createSelectorField=new y(this._partContainer,{defaultValue:this._selectorOriginalValue});this._createSelectorField.value=this._selectorEditableValue;this.createActionSelectorField(this._createSelectorField);this._createSelectorField.selectable.isSelected.subscribe((function(t){t?n._launchCreateActionBlade():n.createActionBladeOpener(u)}))},c.prototype._launchCreateActionBlade=
function(){var n=this.getProviderInputs(null);this.privateFcTpBI.inputs(n);this.itemsGridViewModel.selectableData.selectedItems([]);this.createActionBladeOpener({detailBlade:this._createSelectorBladeName,extension:this._createSelectorBladeExtension,detailBladeInputs:{}})},c.prototype._filterGridItems=function(n){var t=this,r=this.itemsGridViewModel.items(),i=this._filteredItems;n&&n.forEach((function(n){var i=t.getMatchingItemIndex(n.id);i!==-1&&t._disableGridItem(r[i],n.reason)}));i&&i.length>0&&i.forEach((function(n){var i=r.first((function(i){return t.itemMatchesSelection(n.item,i)}));i&&t._disableGridItem(i,n.disabledReason)}))},__decorate([n.Composition.ProxyCompatibilityMode],c)})(h.Loadable.ViewModel);i.BasePickerListViewModel=k})(i=t.ParameterCollection||(t.ParameterCollection={}))})(t=n.ViewModels||(n.ViewModels={}))})(MsPortalFx||(MsPortalFx={})),(function(n){var t;(function(t){var i;(function(i){"use strict";var a=n.Base,s=n.Helpers,h=n.ViewModels,c=h.Controls.Wizard,b=h.ActionBars.Base,
f=undefined,r=null,u=ko.observable,e="",v={getProviderInputs:e,onProviderCommit:e,onInputsReceived:e,onCommitError:e},o=FxImpl.getErrorMap(v),l=h.ParameterCollectionV2.Internal.ParameterCollectorFactory,y=l.confirmCommitSuffix,p=l.tryCommitSuffix,w=(function(e){function h(n,f,o){var s=this,h,c;e.call(this,n,f&&f.content);this.editScopeId=u();this.eula=u("");this.cloudName=u();this._editScopeCache=r;this._editScopeView=r;this._actionBarOutput=r;this._baseCollectorInputs=r;this._baseProviderCommit=r;this._baseProviderOutputs=r;this._baseWizardContainer=r;this._deferredProviderDismiss=r;this._providerBase=r;this._provisionerInstance=r;this._savedProviderOutputs=r;h=this.lifetimeManager;this.valid=ko.computed(h,(function(){return s.steps().every((function(n){return n.isOptional||n.status()===3}))}));c=this._editScopeCache=new FxImpl.Data.EditScopeCacheOld({entityTypeName:o,supplyExistingData:function(n){return s._providerBase.initializeDataModel(n,(function(n){return s.overrideInputParameters(n)})
)},serializeParams:function(){return"#"}});n.registerForDispose(c);this._editScopeView=c.createView(h);this._providerBase=new i.Internal.ProviderBase(this._editScopeView);this.enableProvisioning=u(!1);this.provisionOnStartboardPart=u(!0);this.parameterCollectionErrors=u();this.privateFcTpBI=new i.Internal.CollectorBindingInternals;this.privateFpTcBI=new i.Internal.ProviderBindingInternals;this.privatePcPrBI=new i.Internal.ProvisioningEntityBindingInternals;this._actionBarOutput=u();this._baseProviderCommit=u();this._baseWizardContainer=n;this._provisionerInstance=new i.Internal.Provisioner(this);this._savedProviderOutputs={};this.complete=function(){return};this._actionBarOutput.subscribe(h,(function(n){if(t.ActionBars.Base.isCompleted(n)){var i=s.getOutputsToCommit(),r=function(){var n=s._editScopeCache;n.disposeAndDiscardEdits(s.editScopeId(),s._editScopeView)};s._providerBase.commitProvider({enableProvisioning:s.enableProvisioning(),provisioner:s._provisionerInstance,provisionerData:
i,provisionerOptions:s._baseCollectorInputs.options,progressAction:function(n){s._baseWizardContainer.operations.add(n,{blockUi:!0})},discardEdits:r,privateFpTcBI:s.privateFpTcBI,privatePcPrBI:s.privatePcPrBI,provisionOnStartboardPart:s.provisionOnStartboardPart()})}}));this.parameterCollectionErrors.subscribe(h,(function(n){s.privateFcTpBI.errors(n)}))}return __extends(h,e),Object.defineProperty(h.prototype,"dataModel",{get:function(){var n=this._editScopeView.editScope();return n&&n.root},enumerable:!0,configurable:!0}),h.prototype.onInputsSet=function(t){var w=this,p=r,o,s,c,h,l,u,a,v,e;if(this.cloudName(i.Internal.getCloudNameFromInputs(t)),this.editScopeId(t.editScopeId),this.provisionOnStartboardPart(t.provisionOnStartboardPart),this.privatePcPrBI.masterIsProvisioningPart(t.masterIsProvisioningPart),o=t.privateFcTpBI,o&&(s=o.inputs,s&&(this._baseCollectorInputs=s,c=this._providerBase.onCollectorBindingsReceived(s,this.editScopeId(),(function(n){return w.onInputsReceived(n)})),this.enableProvisioning(
c.enableProvisioning),p=c.promise),h=o.errors,h&&h.length>0)){this.onCommitError(h);this.onCommitError([])}return l=t.privateFpTcBI,t.privateFpTcBI&&(u=l.commit,!u||u===this._baseProviderCommit()||(u===y.format(this._baseProviderCommit())?(a=this._deferredProviderDismiss,a&&(a.resolve(),this._deferredProviderDismiss=f)):(this._baseProviderOutputs=l.outputs,this._baseProviderCommit(u)))),this.initialize(),v=t.stepOutput,v&&this.stepOutput(v),this.savedState()||this.savedState(t.savedState),e=t.output,e&&e.status&&!n.deepEquals(e,this._actionBarOutput())&&this._actionBarOutput(e),p},h.prototype.overrideInputParameters=function(n){return s.resolve(n)},h.prototype.getProviderInputs=function(){return o.getProviderInputs()||f},h.prototype.onProviderCommit=function(){return o.onProviderCommit()||f},h.prototype.onInputsReceived=function(){return o.onInputsReceived()||f},h.prototype.getOutputsToCommit=function(){var n=i.Models.modelToParameters(this.dataModel);return{outputParameters:n}},h.prototype.
onCommitError=function(){return o.onCommitError()||f},h.prototype.addWizardStep=function(n,t,i,u,f,e,o){this.insertWizardStep(r,n,t,i,u,f,e,o)},h.prototype.insertWizardStep=function(n,t,i,r,u,f,e,o){var s=new c.WizardStep(t,i,r,e,f,o);s.description(u);s.stepLoad=this._onStepLoad.bind(this);s.stepComplete=this._onStepComplete.bind(this);typeof n=="number"?this.steps.splice(n,0,s):this.steps.push(s)},h.prototype.removeWizardStep=function(n){this.steps.remove(n)},h.prototype.removeWizardStepAt=function(n){return this.steps.splice(n,1)[0]},h.prototype._onStepLoad=function(n){var t=this,i=s.Deferred();return this._providerBase.fetchEditScope(this.editScopeId(),this._baseCollectorInputs).then((function(){var r=t.getProviderInputs(n.stepId);n.stepId in t._savedProviderOutputs&&a.ProxiedObservables.data(r.options,"lastOutputParameters",t._savedProviderOutputs[n.stepId]);t.privateFcTpBI.inputs(r);i.resolve()})),i.promise()},h.prototype._onStepComplete=function(n){var t=this,i=s.Deferred(),u=this.
lifetimeManager.createChildLifetime();return this._baseProviderCommit.subscribe(u,(function(){t._savedProviderOutputs[n.stepId]=t._baseProviderOutputs;t.onProviderCommit(n.stepId,t._baseProviderOutputs).then((function(n){n?t._baseProviderCommit().indexOf(p)>-1?(t._deferredProviderDismiss=i,t.privateFcTpBI.errors([{errorMessage:r,parameterName:t._baseProviderCommit()}]),t.privateFcTpBI.errors([])):i.resolve():i.reject()}));u.dispose()})),i.promise()},__decorate([n.Composition.ProxyCompatibilityMode],h)})(c.ViewModel);i.BaseWizardViewModel=w})(i=t.ParameterCollection||(t.ParameterCollection={}))})(t=n.ViewModels||(n.ViewModels={}))})(MsPortalFx||(MsPortalFx={})),(function(n){var t;(function(n){var t;(function(n){"use strict";var i=(function(){function n(){this.inputParameters={};this.inputMetadata={};this.options={}}return n})(),t;n.ParameterCollectionInput=i;t=(function(){function n(){this.outputParameters={}}return n})();n.ParameterCollectionOutput=t})(t=n.ParameterCollectionV2||(n.ParameterCollectionV2=
{}))})(t=n.ViewModels||(n.ViewModels={}))})(MsPortalFx||(MsPortalFx={})),(function(n){var t;(function(n){var t;(function(n){"use strict";var t="parameterCollection",i="previousOutputParameters",r=ko.observable,u;(function(n){function u(n){var i={},t,r;for(t in n){t in i||(i[t]={});for(r in n[t])i[t][r]=n[t][r]()||""}return i}function f(n){var u={},t,i;for(t in n)for(i in n[t]){if(t in u||(u[t]={}),ko.isObservable(n[t][i])||ko.isComputed(n[t][i]))throw new Error("Parameters cannot be knockout observables.");u[t][i]?u[t][i](n[t][i]):u[t][i]=r(n[t][i])}return u}function e(n){return n&&t in n&&i in n[t]&&!!n[t][i]?n[t][i]:null}n.modelToParameters=u;n.parametersToModel=f;n.getPreviousOutputsFromOptions=e})(u=n.Utilities||(n.Utilities={}))})(t=n.ParameterCollectionV2||(n.ParameterCollectionV2={}))})(t=n.ViewModels||(n.ViewModels={}))})(MsPortalFx||(MsPortalFx={})),(function(n){var t;(function(t){var i;(function(i){"use strict";function s(n,t){return{stepId:"CommandStep",status:0,isFirstStep:!0,isLastStep:
!0,isOptional:!1,disabled:!1,allowToggleProvisioningLocation:n,masterIsProvisioningPart:t}}var e=n.ViewModels,c=e.ActionBars,f=ko.observable,r="",o={unsetRole:r,setOnce:r,collectorMissing:r},u=FxImpl.getErrorMap(o),h=(function(n){function t(t,r){var u=this;n.call(this,t);this.stepInput=f();this._collectorImpl=null;this._provisionerImpl=null;this._rolesSet=!1;this._baseCommandContainer=null;this._baseCommandInitialState=null;this.privateFcTpBI=new i.Internal.CollectorBindingInternals;this.privatePcPrBI=new i.Internal.ProvisionerBindingInternals;this._baseCommandContainer=t;this._baseCommandInitialState=r;this.enableProvisioning=f(!0);this.stepInput(s(!1,!0));t.registerForDispose(t.selectable.isSelected.subscribe((function(n){n&&u._collectorImpl.sendInputsToProvider(null)})))}return __extends(t,n),t.prototype.onInputsSet=function(n){var t=this,i=[];return this._rolesSet||u.unsetRole(),this._collectorImpl&&i.push(this._collectorImpl.processInputs(n)),this._provisionerImpl&&i.push(this._provisionerImpl.
processInputs(n)),Q.all(i).then((function(){t._provisionerImpl&&t.enableProvisioning(t._provisionerImpl.enableProvisioning())}))},t.prototype.initializeParameterCollectionRoles=function(n){this._rolesSet&&u.setOnce();this._extractCommandRoles(n,this._baseCommandContainer);this._rolesSet=!0},t.prototype._extractCommandRoles=function(n,t){var r=this,f=!!n&&n.parameterCollector,e=!!n&&n.provisioner,o;f||u.collectorMissing();o={commitWhenSignaled:!0,commitAction:function(){if(r._provisionerImpl){var n=function(){var n=r.privateFcTpBI.inputs();r._provisionerImpl.executeProvisioning(r._collectorImpl.providerOutputs,n&&n.options)},i={privateFcTpBI:{inputs:r.privateFcTpBI.inputs()}},t=r._provisionerImpl.processInputs(i);t?t.then(n):n()}r._baseCommandContainer.selectable.isSelected(!1)}};this._collectorImpl=i.Internal.ParameterCollectorFactory.createParameterCollector(f,{},this.privateFcTpBI,t,o);e&&(this._provisionerImpl=i.Internal.ProvisionerFactory.createProvisioner(e,this.privatePcPrBI))},t})(
t.OpenBladeCommand);i.Command=h})(i=t.ParameterCollectionV2||(t.ParameterCollectionV2={}))})(t=n.ViewModels||(n.ViewModels={}))})(MsPortalFx||(MsPortalFx={})),(function(n){var t;(function(t){var i;(function(i){"use strict";var f=n.ViewModels,l=f.ActionBars.Base,y=f.ParameterCollection.Internal,a=HubsExtension.Azure.Pricing,e=n.deepEquals,u=ko.observable,p=ko.observableArray,v=ko.computed,o=a.Constants.LegalTermsBlade,s=a.Constants.PricingSummaryBlade,r=null,w=n.forEachKey,h="",b={setOnce:h,rejected:h,multipleSelectors:h},c=FxImpl.getErrorMap(b),k=(function(h){function a(n,c){var a=this,y,w,b;h.call(this,n);this.editScopeId=u();this.actionInProgress=u(!1);this.enableProvisioning=u(!1);this.eula=u("");this.secondaryLinkDisplayText=u("");this.galleryPricingInfo=u();this.cloudName=u();this._collectorImpl=r;this._providerImpl=r;this._provisionerImpl=r;this._parameterCollectionRolesSet=!1;this._actionBarOutput=r;this._actionInProgressLock=!1;this._baseFormContainer=r;this._baseFormInitialState=
r;this._hotSpotItems=p();this._initialSelectedValue=r;this._previousOutput=r;this._selectableMap={};this._isValid=u(!1);this._galleryItem=u(r);y=c&&c.content&&c.content.selectable;w=c&&c.content&&c.content.secondaryLinkSelectable;this._editScopeImpl||(this._editScopeImpl=r);this.privateFcTpBI=new i.Internal.CollectorBindingInternals;this.privateFpTcBI=new i.Internal.ProviderBindingInternals;this.privatePcPrBI=new i.Internal.ProvisionerBindingInternals;this._baseFormContainer=n;this._baseFormInitialState=c;this._initialSelectedValue=y&&y.selectedValue;this._actionBarOutput=u();this.stepInput=u();this.stepOutput=u();b=this.valid;this.valid=v((function(){return a._isValid()&&b()}));n.registerForDispose(this.valid);this.selectable=new t.Selectable({allowUnselect:!1,selectedValue:this._initialSelectedValue,isSelected:y&&y.isSelected,isActivated:y&&y.isActivated});n.registerForDispose(this.selectable);this.secondaryLinkSelectable=new t.Selectable({allowUnselect:!1,selectedValue:w&&w.selectedValue,
isSelected:w&&w.isSelected,isActivated:w&&w.isActivated});n.registerForDispose(this.secondaryLinkSelectable);this.hotSpot=new t.SelectableSet(this._hotSpotItems,function(n,t){return n.selectedValue()===t},function(n){return n.selectedValue()},c&&c.content&&c.content.hotSpot);n.registerForDispose(this.hotSpot);n.registerForDispose(this._actionBarOutput.subscribe((function(n){var i,r,t;l.isCompleted(n)&&(i=function(){a.actionInProgress(!0);a._providerImpl.getOutputsToCommit().then((function(n){a._providerImpl.commitOutputs({provisioner:a._provisionerImpl,provisionerData:n,progressAction:function(n){a._baseFormContainer.operations.add(n,{blockUi:!0})},discardEdits:a._editScopeImpl.discardEditScopeEdits.bind(a._editScopeImpl),privateFpTcBI:a.privateFpTcBI,privatePcPrBI:a.privatePcPrBI})}))},n.actionButtonClicked&&a.secondaryLinkSelectable.isSelected()?a.secondaryLinkSelectable.selectedValue().detailBlade===o.bladeName?(a._actionInProgressLock=!0,a.secondaryLinkSelectable.isSelected(!1),i()):a.
secondaryLinkSelectable.isSelected(!1):(r=a.galleryPricingInfo(),t=a._galleryItem(),a.enableProvisioning()&&r&&t&&(t.products.length>0||t.productsWithNoPricing.length>0)?(a.secondaryLinkSelectable.selectedValue(f.getBladeSelection(o.bladeExtension,o.bladeName,{galleryPricingInfo:r,galleryItem:t})),a.actionInProgress(!0),a.secondaryLinkSelectable.isSelected(!0)):i()))})));n.registerForDispose(this.selectable.isSelected.subscribe((function(n){n||a._unselectFields()})));n.registerForDispose(this.secondaryLinkSelectable.isSelected.subscribe((function(n){n||a._actionInProgressLock||a.actionInProgress(!1)})));n.registerForDispose(this.stepOutput.subscribe((function(n){var t=a._previousOutput;a._previousOutput=n;!e(t,n)&&l.isCompleted(n)&&a._onSelectorComplete(n.stepId).then((function(){a.selectable.isSelected(!1)}))})));n.registerForDispose(v((function(){a.galleryPricingInfo()&&a._galleryItem()?a.secondaryLinkDisplayText(s.displayText):a.secondaryLinkDisplayText(r)})))}return __extends(a,h),a.prototype.
initializeParameterCollectionRoles=function(n){this._parameterCollectionRolesSet&&c.setOnce();this._extractFormRoles(n,this._baseFormContainer);this._parameterCollectionRolesSet=!0},Object.defineProperty(a.prototype,"dataModel",{get:function(){var n=this._editScopeImpl;return n&&n.dataModel||r},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"inputMetadata",{get:function(){var n=this._editScopeImpl,t=n&&n.collectorInputs,i=t&&t.inputMetadata;return i||r},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"parameterCollectionOptions",{get:function(){var n=this._editScopeImpl,t=n&&n.collectorInputs,i=t&&t.options;return i||r},enumerable:!0,configurable:!0}),a.prototype.onFormInputsSet=function(){return r},a.prototype.onInputsSet=function(n){var t=this,i=[],p,l,a,o,v,h;this.cloudName(y.getCloudNameFromInputs(n));this.editScopeId(n.editScopeId);var u=this._editScopeImpl,w=u&&u.collectorInputs,b=w&&w.inputParameters;b&&(p=b);u&&i.push(u.processInputs(n));l=this.
_collectorImpl;l&&i.push(l.processInputs(n));a=this._providerImpl;a&&i.push(a.processInputs(n));o=this._provisionerImpl;o&&i.push(o.processInputs(n));v=n.stepOutput;v&&this.stepOutput(v);var k=n.privateFcTpBI,d=k&&k.inputs,g=d&&d.options,nt=g&&g.galleryOptions;return this._galleryItem(nt&&nt.galleryItem||r),n.output&&(h=n.output&&n.output.secondaryLinkClicked,!h||h!==this.secondaryLinkDisplayText()||this._previousSecondaryLinkCommitId===n.output.commitId||(this._previousSecondaryLinkCommitId=n.output.commitId,this.actionInProgress(!1),this.secondaryLinkSelectable.selectedValue(f.getBladeSelection(s.bladeExtension,s.bladeName,{galleryPricingInfo:this.galleryPricingInfo(),galleryItem:this._galleryItem()})),this.secondaryLinkSelectable.isSelected(!0)),!n.output.status||h||e(n.output,this._actionBarOutput())||this._actionBarOutput(n.output)),Q.all(i).then((function(){if(o&&t.enableProvisioning(o.enableProvisioning()),!e(p,u.collectorInputs.inputParameters)){var n=t.onFormInputsSet(t._baseFormContainer,
t._baseFormInitialState);if(n)return n.then((function(){t._isValid(!0)}),(function(){c.rejected()}));t._isValid(!0)}}))},a.prototype.dispose=function(){h.prototype.dispose.call(this)},a.prototype.registerHotSpot=function(n){var u=this,t=n.selectable||n,i,r;this._hotSpotItems.push(t);i=this.hotSpot.selectableItems().first((function(n){return n.data===t}));r=ko.utils.twoWayBinding(t.isSelected,i.isActivated);r.forEach((function(n){u._baseFormContainer.registerForDispose(n)}))},a.prototype.registerSelector=function(n,t,i){i&&this._collectorImpl&&this._collectorImpl.addProvider(n,i);this._registerSelectable(n,t.selectable)},a.prototype.registerInfoBox=function(n,t,i){i&&this._collectorImpl&&this._collectorImpl.addProvider(n,i);this._registerSelectable(n,t.selectable)},a.prototype._registerSelectable=function(n,t){var i=this,r;this._selectableMap[n]&&c.multipleSelectors();this._selectableMap[n]=t;r=this._initialSelectedValue;r!==undefined&&e(r,t.selectedValue())&&t.isSelected(this.selectable.isSelected(
));this._baseFormContainer.registerForDispose(t.isSelected.subscribe((function(r){r&&(i._unselectFields(t),i.selectable.selectedValue(t.selectedValue()),i.stepInput({stepId:n,status:0,isLastStep:!1}),i.selectable.isSelected(!0),i._onSelectorLoad(n))})))},a.prototype._extractFormRoles=function(n,t){var e=!!n&&n.parameterCollector,u=!!n&&n.parameterProvider,f=!!n&&n.provisioner,r=this._editScopeImpl;r||(r=this._editScopeImpl=i.Internal.EditScopeFactory.createEditScope(u,t));this.editScope=this._editScopeImpl.editScope;this._providerImpl=i.Internal.ParameterProviderFactory.createParameterProvider(u,r);this._collectorImpl=i.Internal.ParameterCollectorFactory.createParameterCollector(e,r,this.privateFcTpBI,t);f&&(this._provisionerImpl=i.Internal.ProvisionerFactory.createProvisioner(f,this.privatePcPrBI))},a.prototype._unselectFields=function(n){w(this._selectableMap,(function(t,i){n&&n===i||i.isSelected(!1)}))},a.prototype._onSelectorLoad=function(n){var t=this;return this._editScopeImpl.fetchEditScope(
).then((function(){var i=t._collectorImpl;i&&i.sendInputsToProvider(n)}))},a.prototype._onSelectorComplete=function(n){var t=this._collectorImpl;return t?t.commitProviderOutputs(n):Q()},__decorate([n.Composition.ProxyCompatibilityMode],a)})(t.Forms.Form.ViewModel);i.Form=k})(i=t.ParameterCollectionV2||(t.ParameterCollectionV2={}))})(t=n.ViewModels||(n.ViewModels={}))})(MsPortalFx||(MsPortalFx={})),(function(n){var t;(function(t){var i;(function(i){"use strict";var e=n.ViewModels,f=e.Controls,o=f.Lists.Grid,r=ko.observable,c=ko.observableArray,s=n.deepEquals,h=n.getUniqueId,l=i.Internal.ParameterProviderFactory,a=window,u=" is not implemented",v=undefined,y=(function(y){function p(n,u,f,e){var s=this,h,p,w,v,a;e===void 0&&(e=!1);y.call(this,n);this.editScopeId=r();this.eula=r("");this.listHeader=r();this.listSubHeader=r();this.multiselectEnabled=r(!1);this.showCreateAction=r(!1);this.triggerSelectAction=r("");this.valid=r(!1);this.isCreateActionResult=r(!1);this.pickerActivationBladeOpener=r(
);this.createActionBladeOpener=r();this.itemSelectedByDefault=r();this.filterItems=r();this.filters=c();this._filteredItems=[];this._createSelectorField=null;this._selectorOriginalValue=r();this._selectorEditableValue=r();this._createSelectorBladeName=null;this._createSelectorBladeExtension=null;this._throttleUnselectSelectorFieldHandle=null;this._collectorImpl=null;this._providerImpl=null;this._parameterCollectionRolesSet=!1;this._basePickerContainer=null;this._basePickerInitialState=null;this._actionBarOutput=null;h=this.lifetimeManager;this.controlType=80;this._editScopeImpl||(this._editScopeImpl=null);this.privateFcTpBI=new i.Internal.CollectorBindingInternals;this.privateFpTcBI=new i.Internal.ProviderBindingInternals;this.multiselectEnabled(e);this._basePickerContainer=n;this._basePickerInitialState=u;p=this._actionBarOutput=r();w=this.createActionSelectorField=r();this.isCreateActionResult(!1);this.stepInput=r();var b=o.Extensions.SelectableRow,k=this._getGridExtensionOptions(),l=
this.itemsGridViewModel=new o.ViewModel(h,f,b,k);l.showHeader=!0;l.columns=this.getColumns();this._initializeCreateActionSelector();p.subscribe(h,(function(i){if(t.ActionBars.Base.isCompleted(i)){var r=s._providerImpl;r.getOutputsToCommit().then((function(t){r.commitOutputs({provisioner:null,provisionerData:t,progressAction:function(t){n.operations.add(t,{blockUi:!0})},discardEdits:s._editScopeImpl.discardEditScopeEdits.bind(s._editScopeImpl),privateFpTcBI:s.privateFpTcBI,privatePcPrBI:null})}))}}));v=function(n){var t=s.getMatchingItemIndex(n);s._selectGridItem(t)};this.itemSelectedByDefault.subscribe(h,(function(n){s.multiselectEnabled()?n.forEach(v):n&&v(n)}));this.filters.subscribeAndRun(h,(function(){s._filterGridItems(s.filterItems())}));this.filterItems.subscribe(h,(function(n){s._filterGridItems(n)}));l.items.subscribe(h,(function(n){s._filterGridItems(s.filterItems());s._runFilters(n)}));a=l.selectableData.selectedItems;a.subscribe(h,(function(n){s._onSelectedItemsChanged(n)}));this.createActionBladeOpener.
subscribe(h,(function(n){n?(s._clearThrottleUnselectSelectorFieldHandle(),a([]),w().selectable.isSelected(!0)):s._closeBlade(a())}))}return __extends(p,y),p.prototype.initializeCreateSelector=function(n,t,i,r,u,f){this._selectorOriginalValue(n);this._selectorEditableValue(n);this._createSelectorField.label(t);this._createSelectorBladeName=i;this._createSelectorBladeExtension=r;u&&this._collectorImpl&&this._collectorImpl.addProvider(t,u);f&&ko.utils.arrayPushAll(this._createSelectorField.validations,f)},p.prototype.onPickerInputsSet=function(){return null},p.prototype.onInputsSet=function(n){var f=this,i=[],e,t,r,u;return this.editScopeId(n.editScopeId),t=this._editScopeImpl,t&&(r=t.collectorInputs,r&&r.inputParameters&&(e=r.inputParameters),i.push(t.processInputs(n))),this._collectorImpl&&i.push(this._collectorImpl.processInputs(n)),this._providerImpl&&i.push(this._providerImpl.processInputs(n)),this.stepInput(n.stepInput),u=n.output||{},u.status&&!s(u,this._actionBarOutput())&&this._actionBarOutput(
u),Q.all(i).then((function(){if(!s(e,t.collectorInputs.inputParameters))return Q(f.onPickerInputsSet(f._basePickerContainer,f._basePickerInitialState))}))},p.prototype.initializeParameterCollectionRoles=function(n){if(this._parameterCollectionRolesSet)throw new Error("The 'parameterCollectionRoles' property should be only set once.");this._extractPickerRoles(n,this._basePickerContainer);this._parameterCollectionRolesSet=!0},Object.defineProperty(p.prototype,"dataModel",{get:function(){return this._editScopeImpl?this._editScopeImpl.dataModel:null},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"inputMetadata",{get:function(){var n=this._editScopeImpl,t=n&&n.collectorInputs;return t&&t.inputMetadata},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"parameterCollectionOptions",{get:function(){var n=this._editScopeImpl,t=n&&n.collectorInputs;return t&&t.options},enumerable:!0,configurable:!0}),p.prototype.getParameter=function(n,t,i){return t in i&&n in i[
t]?i[t][n]:null},p.prototype.dispose=function(){this._clearThrottleUnselectSelectorFieldHandle();y.prototype.dispose.call(this)},p.prototype.getMatchingItemIndex=function(){throw new Error("'getMatchingItemIndex'"+u);},p.prototype.getColumns=function(){throw new Error("'getColumns'"+u);},p.prototype.itemMatchesSelection=function(){throw new Error("'itemMatchesSelection'"+u);},p.prototype.createSelection=function(){throw new Error("'createSelection'"+u);},p.prototype._extractPickerRoles=function(n,t){var r=this,u=!!n&&n.parameterCollector,f=!!n&&n.parameterProvider,e;this._editScopeImpl||(this._editScopeImpl=i.Internal.EditScopeFactory.createEditScope(f,t,(function(){return r.onPickerInputsSet(r._basePickerContainer,r._basePickerInitialState)})));this._editScopeImpl.initializeEditScope();e={commitWhenSignaled:!0,commitAction:function(){r.isCreateActionResult(!0);r.createActionSelectorField().selectable.isSelected(!1);r.itemsGridViewModel.selectableData.selectedItems([]);r.valid(!0);r.triggerSelectAction(
h())}};this._providerImpl=l.createParameterProvider(f,this._editScopeImpl);u&&(this._collectorImpl=i.Internal.ParameterCollectorFactory.createParameterCollector(u,this._editScopeImpl,this.privateFcTpBI,t,e))},p.prototype._onSelectedItemsChanged=function(n){var t=n&&n.length>0,i;if(t){if(this.isCreateActionResult(!1),i=this._runFilters(n),i){this.valid(!1);return}this._closeBlade(n)}this.valid(t)},p.prototype._runFilters=function(n){var t=this,i,r,u;if(n&&n.length){var f=!1,e=this.filters,o=e&&e();return o&&(i=[],r=[],o.forEach((function(u){u.getDisabledItems(n).then((function(n){n.forEach((function(n){var u=t.itemsGridViewModel.items().first((function(i){return t.itemMatchesSelection(n.item,i)}));u&&(t._disableGridItem(u,n.disabledReason),r.push(u),f=!0,i.push(n))}))}))})),u=this._filteredItems,u.push.apply(u,i),this.itemsGridViewModel.selectableData.selectedItems.removeAll(r)),f}return!1},p.prototype._closeBlade=function(n){var r=this,t,i;this._clearThrottleUnselectSelectorFieldHandle();this.
_throttleUnselectSelectorFieldHandle=setTimeout((function(){var n=r.createActionSelectorField();n&&n.selectable.isSelected(!1)}),0);this.multiselectEnabled()||n.length!==1||(t=this.itemSelectedByDefault(),i=t&&this.itemMatchesSelection(this.itemsGridViewModel.items()[this.getMatchingItemIndex(t)],n[0]),i||this.triggerSelectAction(h()))},p.prototype._clearThrottleUnselectSelectorFieldHandle=function(){var n=this._throttleUnselectSelectorFieldHandle;n&&(a.clearTimeout(n),this._throttleUnselectSelectorFieldHandle=null)},p.prototype._getGridExtensionOptions=function(){return{selectableRow:{selectionMode:this.multiselectEnabled()?2:1,itemMatchesSelection:this.itemMatchesSelection,createSelection:this.createSelection}}},p.prototype._selectGridItem=function(n){if(n!==-1){var t=this.itemsGridViewModel,i=t.getRowMetadata(t.items()[n]);i.selected(!0)}},p.prototype._disableGridItem=function(n,t){var i,r;n&&(i=this.itemsGridViewModel.getRowMetadata(n),i.disabled(!0),t&&n.hasOwnProperty("infoBalloon")&&
(r=n.infoBalloon||(n.infoBalloon=new f.DockedBalloon.ViewModel(this.lifetimeManager)),r.content(t)))},p.prototype._initializeCreateActionSelector=function(){var t=this,n=this._createSelectorField=new e.Forms.Selector.ViewModel(this._basePickerContainer,{defaultValue:this._selectorOriginalValue});n.value=this._selectorEditableValue;this.createActionSelectorField(n);n.selectable.isSelected.subscribe((function(n){n?t._launchCreateActionBlade():t.createActionBladeOpener(v)}))},p.prototype._launchCreateActionBlade=function(){this._collectorImpl.sendInputsToProvider(null);this.itemsGridViewModel.selectableData.selectedItems([]);this.createActionBladeOpener({detailBlade:this._createSelectorBladeName,extension:this._createSelectorBladeExtension,detailBladeInputs:{}})},p.prototype._filterGridItems=function(n){var t=this,r=this.itemsGridViewModel.items,i;n&&n.forEach((function(n){var i=t.getMatchingItemIndex(n.id);i!==-1&&t._disableGridItem(r()[i],n.reason)}));i=this._filteredItems;i&&i.forEach((function(
n){var i=r().first((function(i){return t.itemMatchesSelection(n.item,i)}));i&&t._disableGridItem(i,n.disabledReason)}))},p.filterPickerItemsParameterName="filterPickerItems",p.pickerItemsParameterName="pickerItems",__decorate([n.Composition.ProxyCompatibilityMode],p)})(f.Loadable.ViewModel);i.Picker=y})(i=t.ParameterCollectionV2||(t.ParameterCollectionV2={}))})(t=n.ViewModels||(n.ViewModels={}))})(MsPortalFx||(MsPortalFx={})),(function(n){var t;(function(t){var i;(function(t){"use strict";var i=n.Base,r=n.Resources.Strings.Pickers.AccessDenied,u=(function(){function n(n,t){this._requiredPermission=t;this._mapItemToResourceId=n}return n.prototype.getDisabledItems=function(n){var t=this,u=[],f=[],e=Q.defer();return n.forEach((function(n){f.push(i.Security.hasPermission(t._mapItemToResourceId(n),[t._requiredPermission]).then((function(t){t||u.push({item:n,disabledReason:r.reasonMessage})})))})),Q.allSettled(f).then((function(){return e.resolve(u)})),e.promise},n})();t.ArmRbacFilter=u})(i=t.PickerFilter||
(t.PickerFilter={}))})(t=n.ViewModels||(n.ViewModels={}))})(MsPortalFx||(MsPortalFx={})),(function(n){var t;(function(t){var i;(function(i){"use strict";function c(){return}var s=n.ViewModels.ParameterCollection.Internal,u=ko.observable,f=n.deepEquals,r=null,e="",h={missingRoles:e,setOnce:e},o=FxImpl.getErrorMap(h),l=(function(e){function h(n,f){var o=this,s;e.call(this,n,f&&f.content);this.editScopeId=u();this.enableProvisioning=u(!1);this.eula=u("");this.provisionOnStartboardPart=u(!0);this.cloudName=u();this._collectorImpl=r;this._providerImpl=r;this._provisionerImpl=r;this._parameterCollectionRolesSet=!1;this._actionBarOutput=r;this._baseWizardContainer=r;this._baseWizardInitialState=r;s=this.lifetimeManager;this._editScopeImpl||(this._editScopeImpl=r);this.privateFcTpBI=new i.Internal.CollectorBindingInternals;this.privateFpTcBI=new i.Internal.ProviderBindingInternals;this.privatePcPrBI=new i.Internal.ProvisionerBindingInternals;this._baseWizardContainer=n;this._baseWizardInitialState=
f;this.complete=c.bind(this);this.valid=ko.computed(s,(function(){return o.steps().every((function(n){return n.isOptional||n.status()===3}))}));this._actionBarOutput=u();this._actionBarOutput.subscribe(s,(function(n){t.ActionBars.Base.isCompleted(n)&&o._providerImpl.getOutputsToCommit().then((function(n){o._providerImpl.commitOutputs({provisioner:o._provisionerImpl,provisionerData:n,progressAction:function(n){o._baseWizardContainer.operations.add(n,{blockUi:!0})},discardEdits:o._editScopeImpl.discardEditScopeEdits.bind(o._editScopeImpl),privateFpTcBI:o.privateFpTcBI,privatePcPrBI:o.privatePcPrBI})}))}))}return __extends(h,e),h.prototype.onWizardInputsSet=function(){return},h.prototype.onInputsSet=function(n){var t=this,i=Q.defer(),r=[],h,e,u;return this.cloudName(s.getCloudNameFromInputs(n)),this._parameterCollectionRolesSet||o.missingRoles(),this.editScopeId(n.editScopeId),e=this._editScopeImpl&&this._editScopeImpl.collectorInputs||{},e.inputParameters&&(h=e.inputParameters),this._editScopeImpl&&
r.push(this._editScopeImpl.processInputs(n)),this._collectorImpl&&r.push(this._collectorImpl.processInputs(n)),this._providerImpl&&r.push(this._providerImpl.processInputs(n)),this._provisionerImpl&&r.push(this._provisionerImpl.processInputs(n)),n.stepOutput&&this.stepOutput(n.stepOutput),this.savedState()||this.savedState(n.savedState),u=n.output||{},u.status&&!f(u,this._actionBarOutput())&&this._actionBarOutput(u),Q.all(r).then((function(){if(t._provisionerImpl&&t.enableProvisioning(t._provisionerImpl.enableProvisioning()),f(h,t._editScopeImpl.collectorInputs.inputParameters))i.resolve();else{var n=t.onWizardInputsSet(t._baseWizardContainer,t._baseWizardInitialState);n?n.then((function(){i.resolve()}),(function(){i.reject()})):i.resolve()}t.initialize()}),(function(){i.reject()})),i.promise},h.prototype.initializeParameterCollectionRoles=function(n){this._parameterCollectionRolesSet&&o.setOnce();this._extractWizardRoles(n,this._baseWizardContainer);this._parameterCollectionRolesSet=!0},Object.
defineProperty(h.prototype,"dataModel",{get:function(){if(this._editScopeImpl)return this._editScopeImpl.dataModel},enumerable:!0,configurable:!0}),Object.defineProperty(h.prototype,"inputMetadata",{get:function(){var n=this._editScopeImpl&&this._editScopeImpl.collectorInputs||{};return n.inputMetadata},enumerable:!0,configurable:!0}),Object.defineProperty(h.prototype,"parameterCollectionOptions",{get:function(){var n=this._editScopeImpl&&this._editScopeImpl.collectorInputs||{};return n.options},enumerable:!0,configurable:!0}),h.prototype.addWizardStep=function(n,t,i,u,f,e,o,s){this.insertWizardStep(r,n,t,i,u,f,e,o,s)},h.prototype.insertWizardStep=function(n,i,r,u,f,e,o,s,h){var c=new t.Controls.Wizard.WizardStep(i,r,u,s,o,h);c.description(f);c.stepLoad=this._onStepLoad.bind(this);c.stepComplete=this._onStepComplete.bind(this);typeof n=="number"?this.steps.splice(n,0,c):this.steps.push(c);e&&this._collectorImpl&&this._collectorImpl.addProvider(i,e)},h.prototype.removeWizardStep=function(
n){this._collectorImpl&&this._collectorImpl.removeProvider(n.stepId);this.steps.remove(n)},h.prototype.removeWizardStepAt=function(n){return this._collectorImpl&&this._collectorImpl.removeProvider(this.steps()[n].stepId),this.steps.splice(n,1)[0]},h.prototype._extractWizardRoles=function(n,t){var f=!!n&&n.parameterCollector,r=!!n&&n.parameterProvider,u=!!n&&n.provisioner;this._editScopeImpl||(this._editScopeImpl=i.Internal.EditScopeFactory.createEditScope(r,t));this._editScopeImpl.initializeEditScope();this._collectorImpl=i.Internal.ParameterCollectorFactory.createParameterCollector(f,this._editScopeImpl,this.privateFcTpBI,t);this._providerImpl=i.Internal.ParameterProviderFactory.createParameterProvider(r,this._editScopeImpl);u&&(this._provisionerImpl=i.Internal.ProvisionerFactory.createProvisioner(u,this.privatePcPrBI))},h.prototype._onStepLoad=function(n){var t=this;return this._editScopeImpl.fetchEditScope().then((function(){t._collectorImpl&&t._collectorImpl.sendInputsToProvider(n.stepId)})
)},h.prototype._onStepComplete=function(n){return this._collectorImpl?this._collectorImpl.commitProviderOutputs(n.stepId):Q()},__decorate([n.Composition.ProxyCompatibilityMode],h)})(t.Controls.Wizard.ViewModel);i.Wizard=l})(i=t.ParameterCollectionV2||(t.ParameterCollectionV2={}))})(t=n.ViewModels||(n.ViewModels={}))})(MsPortalFx||(MsPortalFx={}))